# Evaluation: UI Features v2 - New Features
Generated: 2026-01-20T06:38:00Z
Topic: ui-features-v2 (continuation)

## Executive Summary

**Status**: CONTINUE

User has identified 6 new UI features needed beyond the previously planned P3-P8 work. Previous P3 (Connection Matrix) and P4 (Split Sidebar) are complete. P5, P7, P8 have partial implementations. New features focus on port interaction, inspector enhancements, and context menus.

## Completed Work (from previous plans)

| Item | Status | Notes |
|------|--------|-------|
| P0: Block Model Enhancements | âœ… COMPLETE | displayName, domainId, role fields |
| P1: BlockRole System | âœ… COMPLETE | All roles have meta fields |
| P2: Bus Block | âœ… COMPLETE | 2-in/2-out bus block |
| P3: Connection Matrix | âœ… COMPLETE | Full matrix with bus grouping |
| P4: Split Sidebar | âœ… COMPLETE | Library/Inspector split |
| P5: TimeRoot Hidden | âœ… COMPLETE | Filtered from UI views |
| P6: RailId Type | âœ… COMPLETE | Removed from types |

## Partially Complete Work

| Item | Status | What's Done | What's Missing |
|------|--------|-------------|----------------|
| P7: DefaultSource Display | ðŸŸ¡ PARTIAL | Default sources shown in tooltips, indicator dots | Not editable, no Inspector section |
| P8: Block Type Preview | ðŸŸ¡ PARTIAL | Preview mode exists | Works but limited info shown |

## New Features Requested (User Feedback)

Six new features have been captured as beads:

### 1. oscilla-animator-v2-471: Editable default sources in inspector
**Confidence**: MEDIUM
- Need to design edit UX for different default source types
- Const values: sliders/number inputs
- Rail references: dropdown selector
- Must integrate with live recompile

### 2. oscilla-animator-v2-vr6: Improved port visualization
**Confidence**: HIGH
- Current: 10x10px handles with tooltip only
- Need: Larger handles, visible port labels, type colors
- OscillaNode.tsx is the target file
- Clear implementation path

### 3. oscilla-animator-v2-0yp: Compatible port highlighting on hover
**Confidence**: MEDIUM
- Need hover state detection on ReactFlow handles
- Type compatibility checking exists (typeValidation.ts)
- Need global highlight state across all nodes
- ReactFlow custom node updates needed

### 4. oscilla-animator-v2-2s4: Port Inspector panel
**Confidence**: HIGH
- Extend existing SelectionStore for port selection
- BlockInspector already handles edge selection
- Pattern is established - add port mode
- Clear implementation path

### 5. oscilla-animator-v2-5mg: Context menus for blocks, ports, edges
**Confidence**: MEDIUM
- ReactFlow has onContextMenu callbacks
- Need shared context menu component
- Different menus per element type
- Actions need to integrate with PatchStore

### 6. oscilla-animator-v2-nu6: Connect/disconnect edges from Inspector
**Confidence**: MEDIUM
- Inspector already shows port info
- Need connection picker component (modal or dropdown)
- Must filter by type compatibility
- Disconnect is simpler - just remove edge

## Architecture Notes

### Current Selection State
```typescript
// SelectionStore
selectedBlockId: BlockId | null
selectedEdgeId: string | null
previewType: string | null
```

**Missing**: No port selection support. Need to add:
```typescript
selectedPortRef: PortRef | null  // { blockId, portId, direction }
```

### Current Port Rendering (OscillaNode.tsx)
- Handles are 10x10px with 2px border
- Color-coded by type (typeColor from PortData)
- Tooltip shows type info and default source
- Default source indicator dot (6x6px) above input ports

### Type Validation
`src/ui/reactFlowEditor/typeValidation.ts` already has:
- `validateConnection()` - checks type compatibility
- Uses `isAssignableTo()` from type system

## Dependencies

```
Port Inspector (2s4)
    â””â”€ requires port selection in SelectionStore

Connect from Inspector (nu6)
    â””â”€ requires Port Inspector pattern
    â””â”€ requires connection picker component

Compatible Highlighting (0yp)
    â””â”€ requires type compatibility queries
    â””â”€ affects all OscillaNode instances

Editable Default Sources (471)
    â””â”€ partial - P7 DefaultSource display exists
    â””â”€ needs edit controls per param type

Context Menus (5mg)
    â””â”€ standalone, can be done in parallel
```

## Risks

1. **Port highlighting performance**: Hovering one port must update all nodes. Need efficient React update strategy.

2. **Connection picker UX**: For patches with many blocks, picker could be overwhelming. Need filtering/search.

3. **ReactFlow customization limits**: Some features may need workarounds if ReactFlow doesn't support them directly.

## Recommended Sprint Structure

### Sprint 1: Port Visualization + Port Inspector (HIGH confidence)
- Improved port visualization (vr6)
- Port Inspector panel (2s4)
- Add port selection to SelectionStore
- These are foundational for other features

### Sprint 2: Context Menus (MEDIUM confidence)
- Context menus for blocks, ports, edges (5mg)
- Standalone feature, well-defined scope
- Research: best React context menu library

### Sprint 3: Port Interaction Features (MEDIUM confidence)
- Compatible port highlighting on hover (0yp)
- Connect/disconnect from Inspector (nu6)
- Builds on Sprint 1 port selection
- Needs connection picker design

### Sprint 4: Default Source Editing (MEDIUM confidence)
- Editable default sources (471)
- Builds on existing P7 display
- Needs per-type edit controls design
- Integration with live recompile

## Verdict: CONTINUE

Clear path forward. Creating sprint plans with confidence ratings.

# Definition of Done: UI Features v2 - Phase 2 Completion + DefaultSource Display

**Topic**: UI Features v2 - Phase 2 Completion
**Created**: 2026-01-10
**Plan**: PLAN-20260110-150000.md

## Acceptance Criteria

### P3: Connection Matrix Table View
- [ ] Matrix renders with block IDs/displayNames as row headers
- [ ] Matrix renders with block IDs/displayNames as column headers
- [ ] Cells show ● when edge exists (row=source → col=target)
- [ ] Multiple edges show count: ●2, ●3, etc.
- [ ] Click cell → selects all edges between those blocks
- [ ] Click row header → selects that block
- [ ] Diagonal cells show = (self-reference indicator)
- [ ] Bus blocks grouped in separate "BUSES" section below matrix
- [ ] TimeRoot blocks filtered out entirely
- [ ] Horizontal scroll works for wide matrices

### P4: Split Sidebar Layout
- [ ] SplitPanel component exists at `src/ui/components/SplitPanel.ts`
- [ ] Left sidebar uses SplitPanel (not TabbedContent)
- [ ] Library panel in top section
- [ ] Inspector panel in bottom section
- [ ] Divider is visible and draggable
- [ ] Divider respects minimum heights (Library 150px, Inspector 200px)
- [ ] Right sidebar still uses TabbedContent (unchanged)

### P5: TimeRoot Hidden
- [ ] Blocks with `role.kind === 'timeRoot'` not shown in connection matrix
- [ ] TimeRoot block types not shown in Library
- [ ] Inspector shows "System block (hidden)" if timeRoot selected
- [ ] Demo patch time blocks use `timeRootRole()`

### P7: DefaultSource Display
- [ ] DefaultSource type has kind discriminant: `'rail' | 'constant' | 'none'`
- [ ] At least 3 block types have defaultSources defined in registry
- [ ] Inspector shows "(not connected)" for unconnected input ports
- [ ] Below unconnected ports, shows "Default: {value}" or "Default: {railName}"
- [ ] Rail names are styled distinctively (e.g., italic or colored)
- [ ] "none" defaults shown as "Default: (none)"

### P8: Block Type Preview
- [ ] Selection state has `previewType: string | null` field
- [ ] Clicking block type in Library sets previewType
- [ ] Inspector shows type preview when previewType is set
- [ ] Preview shows "[TYPE PREVIEW]" header to distinguish from block inspection
- [ ] Preview shows: type name, category, description
- [ ] Preview shows inputs with types and default sources
- [ ] Preview shows outputs with types
- [ ] Selecting an actual block clears previewType

## Verification

### Automated
- [ ] TypeScript compiles without errors (`npm run typecheck`)
- [ ] All tests pass (`npm run test`)

### Manual (Runtime Verification)
- [ ] Load app, see connection matrix with demo patch blocks
- [ ] Matrix shows connections between blocks correctly
- [ ] No time-related blocks visible in matrix or library
- [ ] Click cell → edge selection updates (if selection state has edge support)
- [ ] Split panel: drag divider to resize Library/Inspector
- [ ] Click block type in Library → Inspector shows preview
- [ ] Click block in matrix → Inspector shows block details
- [ ] Unconnected ports show default sources in Inspector

## Out of Scope (Verified NOT implemented)
- Editing capabilities (add/remove blocks)
- Wiring (add/remove edges)
- Domain propagation logic
- Variadic ports

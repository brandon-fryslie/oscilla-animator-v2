# Definition of Done: UI Features v2

**Topic**: UI Features v2 - Visualization & Inspection
**Created**: 2026-01-09
**Plan**: PLAN-20260109-235000.md

## Acceptance Criteria

### P0: Core Infrastructure
- [x] Directory structure created: `src/ui/components/`, `src/ui/state/`, `src/ui/registry/`
- [x] Selection state management implemented (tracks selected block/edge/port)
- [x] UI state integrates with existing AppLayout
- [x] Block type registry with 17 block definitions

### P1: Table View (Basic)
- [x] Table component renders in center panel
- [x] Shows all blocks from current patch with columns: Name, Type, Domain, Inputs, Outputs
- [x] Row click selects block (updates global selection state)
- [x] Expandable rows show port details and connections
- [x] Shows connection targets for each port (block.port format)
- [x] Click connections to navigate between blocks

### P2: Block Inspector
- [x] Inspector panel renders in left sidebar (tab)
- [x] Shows "No block selected" when nothing selected
- [x] When block selected, shows:
  - [x] Block ID and type
  - [x] All input ports with types and connections
  - [x] All output ports with types and connections
  - [x] Parameters display
  - [ ] Default sources for inputs (deferred - not in current Patch model)
  - [ ] Domain assignment (deferred - not in current Patch model)
- [x] Clicking a connection navigates to that block (updates selection)

### P3: Block Library
- [x] Library panel renders in left sidebar (tab alongside Inspector)
- [x] Lists available block types grouped by category
- [x] Search/filter functionality
- [ ] Clicking a block type shows preview info in Inspector (deferred to next phase)
- [x] Categories: Time, Domain, Constants, Field Operations, Rendering, Math, Color

### P4: Domains Panel
- [x] Panel renders in right sidebar
- [x] Lists all domains defined in the patch (extracted from DomainN/GridDomain blocks)
- [x] Shows domain properties (kind, n/rows/cols, seed)
- [x] Expandable/collapsible domain entries
- [x] Shows "Used by: N blocks" count

### P5: Rails Section in Table
- [ ] Rails shown in separate section of table view (deferred - rail identification pending)
- [ ] Shows rail name, type, default source, combine mode
- [ ] Rails are visually distinct from regular blocks

## Verification

### Automated
- [x] TypeScript compiles without errors (`npm run typecheck`)
- [x] Existing tests pass (`npm run test`) - 146 tests passing
- [ ] Dev server runs (`npm run dev`) - needs manual verification

### Manual (Runtime)
- [ ] Table view displays the demo patch blocks correctly
- [ ] Selecting a block updates the inspector
- [ ] Inspector shows accurate connection information
- [ ] Library shows block types organized by category
- [ ] Can navigate between blocks by clicking connections
- [ ] UI remains responsive at 60fps with animation running

## Out of Scope (Deferred)
- Adding/removing blocks (editing)
- Adding/removing edges (editing)
- Domain propagation mechanism (needs spec clarification)
- Default sources display (needs Patch model update)
- Domain assignment display (needs Patch model update)
- Rails identification and separate display (needs rail system design)
- Lanes view
- Edge Inspector
- Port Inspector
- Block type preview in Inspector

## Notes

**Completed (2026-01-09 14:55):**
- P0-P4 implemented and tested
- P5 deferred pending rail system design
- Some P2/P3 features deferred pending data model updates
- All automated tests passing
- Manual runtime verification required

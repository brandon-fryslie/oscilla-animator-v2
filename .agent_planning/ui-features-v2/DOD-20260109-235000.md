# Definition of Done: UI Features v2

**Topic**: UI Features v2 - Visualization & Inspection
**Created**: 2026-01-09
**Plan**: PLAN-20260109-235000.md

## Acceptance Criteria

### P0: Core Infrastructure
- [ ] Directory structure created: `src/ui/components/`, `src/ui/state/`
- [ ] Selection state management implemented (tracks selected block/edge/port)
- [ ] UI state integrates with existing AppLayout

### P1: Table View (Basic)
- [ ] Table component renders in center panel
- [ ] Shows all blocks from current patch with columns: Name, Type, Domain, Inputs, Outputs
- [ ] Row click selects block (updates global selection state)
- [ ] Expandable rows show port details and connections
- [ ] Shows connection targets for each port (block.port format)

### P2: Block Inspector
- [ ] Inspector panel renders in left sidebar (tab)
- [ ] Shows "No block selected" when nothing selected
- [ ] When block selected, shows:
  - Block ID and type
  - All input ports with types and connections
  - All output ports with types and connections
  - Default sources for inputs (if any)
  - Domain assignment (if any)
- [ ] Clicking a connection navigates to that block (updates selection)

### P3: Block Library
- [ ] Library panel renders in left sidebar (tab alongside Inspector)
- [ ] Lists available block types grouped by category
- [ ] Search/filter functionality
- [ ] Clicking a block type shows preview info in Inspector
- [ ] Categories: Time, Domain, Constants, Field Operations, Rendering, Math, Color

### P4: Domains Panel
- [ ] Panel renders in right sidebar
- [ ] Lists all domains defined in the patch
- [ ] Shows domain properties (kind, n/rows/cols, seed)
- [ ] Expandable/collapsible domain entries
- [ ] Shows "Used by: N blocks" count

### P5: Rails Section in Table
- [ ] Rails shown in separate section of table view
- [ ] Shows rail name, type, default source, combine mode
- [ ] Rails are visually distinct from regular blocks

## Verification

### Automated
- [ ] TypeScript compiles without errors (`npm run typecheck`)
- [ ] Existing tests pass (`npm run test`)
- [ ] Dev server runs (`npm run dev`)

### Manual (Runtime)
- [ ] Table view displays the demo patch blocks correctly
- [ ] Selecting a block updates the inspector
- [ ] Inspector shows accurate connection information
- [ ] Library shows block types organized by category
- [ ] Can navigate between blocks by clicking connections
- [ ] UI remains responsive at 60fps with animation running

## Out of Scope (Deferred)
- Adding/removing blocks (editing)
- Adding/removing edges (editing)
- Domain propagation mechanism
- Lanes view
- Edge Inspector
- Port Inspector

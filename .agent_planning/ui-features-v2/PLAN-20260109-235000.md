# UI Features v2 - Implementation Plan

**Created**: 2026-01-09
**Status**: DRAFT - Awaiting Approval
**Goal**: Visualization and inspection of patch structure

## Overview

Build UI components to visualize and understand the current patch. This is **read-only initially** - editing comes in a future phase.

### What We're Building

1. **Table View** - Primary patch visualization (center panel)
2. **Block Inspector** - Detail view for selected block (left sidebar)
3. **Block Library** - Available block types (left sidebar, tab)
4. **Domains Panel** - View/edit domain definitions (right sidebar)

### What We're NOT Building Yet

- Adding/removing blocks
- Adding/removing edges
- Macro/composite system
- Lanes view (table view first)
- Full editing capabilities

---

## Component 1: Table View

**Location**: Center panel (replaces current single Preview tab)
**Purpose**: Matrix showing all blocks, rails, and their connections

### Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Search blocks...]                    [Show: All â–¼]          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ BLOCKS                                                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Block          â”‚ Type   â”‚ Domain â”‚ Inputs â”‚ Outputs     â”‚  â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚ â”‚ â–¸ time         â”‚ Infin..â”‚   -    â”‚   0    â”‚ phaseA (2)  â”‚  â”‚
â”‚ â”‚ â–¸ domain       â”‚ Domain â”‚ partic â”‚   0    â”‚ domain (8)  â”‚  â”‚
â”‚ â”‚ â–¸ id01         â”‚ Field..â”‚ partic â”‚   1    â”‚ id01 (5)    â”‚  â”‚
â”‚ â”‚ â–¸ radiusPulse  â”‚ Field..â”‚ partic â”‚   4    â”‚ value (1)   â”‚  â”‚
â”‚ â”‚ ...            â”‚        â”‚        â”‚        â”‚             â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ RAILS                                                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚ â”‚ Rail           â”‚ Type   â”‚ Default  â”‚ Combine   â”‚           â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚
â”‚ â”‚ phaseA         â”‚ Signal â”‚ time.out â”‚ last      â”‚           â”‚
â”‚ â”‚ energy         â”‚ Signal â”‚ 0.5      â”‚ sum       â”‚           â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Interactions

- **Click row**: Select block/rail, show in Inspector
- **Click expand (â–¸)**: Show block's ports and connections inline
- **Click domain cell**: (Future) Choose/change domain for subgraph
- **Hover**: Show tooltip with type details

### Expanded Block View

```
â”‚ â–¾ radiusPulse    â”‚ FieldPulse â”‚ particles â”‚        â”‚             â”‚
â”‚   â”œâ”€ phase     â† â”‚ Signal     â”‚           â”‚ time.phaseA          â”‚
â”‚   â”œâ”€ id01      â† â”‚ Field<num> â”‚           â”‚ id01.id01            â”‚
â”‚   â”œâ”€ base      â† â”‚ Signal     â”‚           â”‚ radiusBase.out       â”‚
â”‚   â”œâ”€ amplitude â† â”‚ Signal     â”‚           â”‚ radiusAmplitude.out  â”‚
â”‚   â”œâ”€ spread    â† â”‚ Signal     â”‚           â”‚ radiusSpread.out     â”‚
â”‚   â””â”€ value     â†’ â”‚ Field<num> â”‚           â”‚ â†’ effectiveRadius    â”‚
```

### Data Required

From `Patch`:
- `blocks`: Map of all blocks with id, type, params
- `edges`: All connections between blocks
- `rails`: (need to identify - blocks with passthrough role?)

Derived:
- Input/output counts per block
- Connection targets per port
- Domain assignments (TBD - open design question)

---

## Component 2: Block Inspector

**Location**: Left sidebar (tab alongside Library)
**Purpose**: Detailed view of selected block

### Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ INSPECTOR                          [Ã—]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ radiusPulse                             â”‚
â”‚ FieldPulse                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ INPUTS                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ phase    Signal<number>         â— â”€â”€â”¼â”€â”‚â†’ time.phaseA
â”‚ â”‚ id01     Field<number>          â— â”€â”€â”¼â”€â”‚â†’ id01.id01
â”‚ â”‚ base     Signal<number>         â— â”€â”€â”¼â”€â”‚â†’ radiusBase.out
â”‚ â”‚ amplitude Signal<number>        â— â”€â”€â”¼â”€â”‚â†’ radiusAmplitude.out
â”‚ â”‚ spread   Signal<number>         â— â”€â”€â”¼â”€â”‚â†’ radiusSpread.out
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ OUTPUTS                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ value    Field<number>          â— â”€â”€â”¼â”€â”‚â†’ effectiveRadius.radius
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ DEFAULT SOURCES                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ phase    â† phaseA (rail)            â”‚ â”‚
â”‚ â”‚ base     â† 0.35 (constant)          â”‚ â”‚
â”‚ â”‚ spread   â† (none)                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ DOMAIN                                  â”‚
â”‚ particles (N=5000)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### States

- **No selection**: "No block selected"
- **Block selected**: Show block details
- **Edge selected**: (Future) Show edge details
- **Port selected**: (Future) Show port details

### Interactions

- **Click connection**: Navigate to connected block
- **Click port indicator (â—/â—‹)**: (Future) Start wiring mode

---

## Component 3: Block Library

**Location**: Left sidebar (tab alongside Inspector)
**Purpose**: Browse available block types

### Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LIBRARY                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Search blocks...]                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â–¾ Time                                  â”‚
â”‚   â”œâ”€ InfiniteTimeRoot                   â”‚
â”‚   â”œâ”€ CycleTimeRoot                      â”‚
â”‚   â””â”€ FiniteTimeRoot                     â”‚
â”‚ â–¾ Domain                                â”‚
â”‚   â”œâ”€ DomainN                            â”‚
â”‚   â””â”€ GridDomain                         â”‚
â”‚ â–¾ Constants                             â”‚
â”‚   â””â”€ ConstFloat                         â”‚
â”‚ â–¾ Field Operations                      â”‚
â”‚   â”œâ”€ FieldFromDomainId                  â”‚
â”‚   â”œâ”€ FieldPulse                         â”‚
â”‚   â”œâ”€ FieldAdd                           â”‚
â”‚   â”œâ”€ FieldGoldenAngle                   â”‚
â”‚   â””â”€ ...                                â”‚
â”‚ â–¾ Rendering                             â”‚
â”‚   â””â”€ RenderInstances2D                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Interactions

- **Click block type**: Show type info in Inspector (preview mode)
- **Double-click**: (Future) Add to patch
- **Drag**: (Future) Add to patch at position

### Data Required

- Block type registry with:
  - Type name
  - Category
  - Description
  - Input port definitions (name, type, default source options)
  - Output port definitions (name, type)

---

## Component 4: Domains Panel

**Location**: Right sidebar
**Purpose**: View and edit domain definitions

### Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DOMAINS                          [+ Add]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â–¾ particles                       [ğŸ—‘ï¸]  â”‚
â”‚   Kind:  [N Elements â–¼]                 â”‚
â”‚   Count: [5000      ]                   â”‚
â”‚   Seed:  [42        ]                   â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€             â”‚
â”‚   Used by: 12 blocks                    â”‚
â”‚   Provides: id01, rand                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â–¸ background                      [ğŸ—‘ï¸]  â”‚
â”‚   Grid 10Ã—10                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Interactions

- **Expand/collapse**: Show/hide inline editor
- **Edit fields**: Direct inline editing
- **Click "Used by"**: Filter table to show blocks using this domain
- **Add**: Create new domain definition
- **Delete**: Remove domain (with confirmation if in use)

---

## Open Design Questions

### 1. Domain Propagation

How does domain get associated with blocks in a subgraph?

**Options considered**:
- Domain wired explicitly to every block (verbose)
- Domain propagates forward from source (limits reuse)
- Domain propagates backward from sink (promising but complex)
- Derived "DomainConnection" blocks (implementation detail)

**Decision**: Defer. For initial implementation, domains can be a property of blocks that we display. The propagation/inference mechanism can be designed once we see real usage patterns.

### 2. Rails Identification

How do we identify which blocks are "rails" (passthrough buses)?

**Current thinking**: Blocks with a specific role or type that indicates passthrough behavior. Need to check spec and current implementation.

### 3. Default Sources

How are default sources represented and connected?

**Current thinking**: Each input port can have a `defaultSource` property pointing to a rail or constant. Graph normalization creates the actual connections.

---

## Implementation Order

### P0: Core Infrastructure
1. [ ] Create `src/ui/components/` directory structure
2. [ ] Define TypeScript interfaces for UI state (selection, etc.)
3. [ ] Create block type registry (or use existing if available)

### P1: Table View (Basic)
4. [ ] Table component with blocks list
5. [ ] Type and connection count columns
6. [ ] Row selection â†’ updates global selection state
7. [ ] Expand/collapse to show ports

### P2: Inspector
8. [ ] Inspector panel component
9. [ ] Block inspector view
10. [ ] Port list with connection display
11. [ ] Click-to-navigate for connections

### P3: Library
12. [ ] Library panel component
13. [ ] Block type list grouped by category
14. [ ] Search/filter
15. [ ] Preview selected type in inspector

### P4: Domains Panel
16. [ ] Domains panel component
17. [ ] List domains from patch
18. [ ] Inline editing (if domains exist in model)
19. [ ] Add/remove (if editing is in scope)

### P5: Rails in Table View
20. [ ] Identify rail blocks
21. [ ] Separate section in table
22. [ ] Show default source, combine mode

---

## File Structure

```
src/ui/
â”œâ”€â”€ index.ts              # Existing - exports
â”œâ”€â”€ AppLayout.ts          # Existing - panel infrastructure
â”œâ”€â”€ TabbedContent.ts      # Existing - tabs
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ TableView.ts      # Main table component
â”‚   â”œâ”€â”€ BlockInspector.ts # Inspector for blocks
â”‚   â”œâ”€â”€ BlockLibrary.ts   # Library panel
â”‚   â”œâ”€â”€ DomainsPanel.ts   # Domains editor
â”‚   â””â”€â”€ shared/
â”‚       â”œâ”€â”€ PortList.ts   # Reusable port listing
â”‚       â””â”€â”€ TypeBadge.ts  # Type indicator component
â”œâ”€â”€ state/
â”‚   â””â”€â”€ selection.ts      # Selection state management
â””â”€â”€ registry/
    â””â”€â”€ blockTypes.ts     # Block type definitions for library
```

---

## Success Criteria

When complete, we should be able to:

1. **See all blocks** in the current patch with their types
2. **See all connections** - which ports are wired to what
3. **Inspect any block** - full detail including params, ports, connections
4. **Browse block types** - see what's available to add (even if can't add yet)
5. **See domains** - what domains exist and their configuration
6. **Understand data flow** - follow connections from source to sink

This gives us the foundation for the editing phase that follows.

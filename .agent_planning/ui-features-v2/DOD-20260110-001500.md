# Definition of Done: UI Features v2 - Phase 2

**Topic**: UI Features v2 - Phase 2
**Created**: 2026-01-10
**Plan**: PLAN-20260110-001500.md

## Acceptance Criteria

### P0: Connection Matrix Table View
- [ ] Table is a matrix: rows = blocks, columns = blocks
- [ ] Row headers show block ID and type
- [ ] Column headers show block ID
- [ ] Cell shows edge indicator (●) when connection exists (row → col)
- [ ] Cell shows edge count if multiple edges between same blocks
- [ ] Clicking cell selects edge(s) between those blocks
- [ ] Clicking row header selects that block
- [ ] Diagonal cells marked as N/A (no self-connections)

### P1: Rails Section in Matrix
- [ ] Matrix divided into sections: Blocks, then Rails
- [ ] Section headers visually distinct
- [ ] Rails appear in both rows and columns
- [ ] Connections between blocks↔rails and rails↔rails visible

### P2: DefaultSource on Ports
- [ ] `DefaultSource` interface: `{ kind: 'rail' | 'constant'; railId?: RailId; value?: unknown }`
- [ ] Block type registry includes defaultSource for applicable inputs
- [ ] Inspector shows default source: "Default: phaseA (rail)" or "Default: 0.5"
- [ ] Ports without defaults show no default indicator

### P3: Domain Assignment Display
- [ ] `Block` interface has `domainId: string | null` (REQUIRED, not optional)
- [ ] PatchBuilder.addBlock() requires domainId parameter
- [ ] Inspector shows "DOMAIN" section with clickable link
- [ ] Clicking domain link navigates to Domains panel and highlights domain
- [ ] Demo patch has domainId set on all blocks

### P4: Block Type Preview in Inspector
- [ ] Clicking block type in Library shows preview in Inspector
- [ ] Preview shows: type name, description, all ports with types
- [ ] Preview has "TYPE PREVIEW" header to distinguish from selected block
- [ ] Clicking patch block clears preview and shows actual block

### P5: Split Sidebar Layout
- [ ] Left sidebar has horizontal split: Library (top), Inspector (bottom)
- [ ] Resizable divider between Library and Inspector
- [ ] Both panels visible simultaneously (no tabs)
- [ ] Right sidebar unchanged (Domains + Help as tabs)

## Verification

### Automated
- [ ] TypeScript compiles without errors (`npm run typecheck`)
- [ ] Existing tests pass (`npm run test`)

### Manual (Runtime)
- [ ] Matrix shows connections correctly (verify against demo patch edges)
- [ ] Rails section visible if Rails exist in patch
- [ ] Default sources display on applicable ports
- [ ] Domain link navigates to correct domain in Domains panel
- [ ] Library click shows type preview, patch click shows block details
- [ ] Library and Inspector both visible in split layout

## Out of Scope
- Domain propagation logic
- Default source auto-wiring
- Edge editing in matrix cells
- Any patch editing

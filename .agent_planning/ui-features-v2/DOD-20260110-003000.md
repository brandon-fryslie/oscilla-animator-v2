# Definition of Done: UI Features v2 - Phase 2 (Revised)

**Topic**: UI Features v2 - Phase 2
**Created**: 2026-01-10
**Plan**: PLAN-20260110-003000.md

## Acceptance Criteria

### P0: Block Model Enhancements
- [ ] Block interface has `displayName: string | null` (REQUIRED)
- [ ] Block interface has `domainId: string | null` (REQUIRED)
- [ ] Block interface has `role: BlockRole` (REQUIRED)
- [ ] PatchBuilder.addBlock() accepts/requires new fields
- [ ] All test files updated with new Block fields
- [ ] Demo patch has all blocks with proper fields set

### P1: BlockRole System Redesign
- [ ] All BlockRole kinds have meta field
- [ ] New roles: `timeRoot`, `bus`, `domain`, `renderer`
- [ ] Helper functions: `userRole()`, `timeRootRole()`, `busRole()`, etc.
- [ ] DerivedBlockMeta unchanged (already has structure)

### P2: Bus Block
- [ ] Rail renamed to Bus everywhere
- [ ] Bus has 2 inputs: `in_0`, `in_1` (optional)
- [ ] Bus has 2 outputs: `out_0`, `out_1`
- [ ] Passthrough: `out_N = in_N` (or default 0 if not connected)
- [ ] Test file renamed and tests pass

### P3: Connection Matrix Table View
- [ ] Matrix: rows = blocks, columns = blocks
- [ ] Row headers: displayName (or id) + type
- [ ] Column headers: displayName (or id)
- [ ] Cell shows ● when edge exists (row→col)
- [ ] Shows edge count if multiple edges between blocks
- [ ] Click cell → select edge(s)
- [ ] Click row → select block
- [ ] Diagonal = N/A
- [ ] Buses in separate "Buses" section
- [ ] TimeRoot blocks not shown

### P4: Split Sidebar Layout
- [ ] Left sidebar: Library (top) + Inspector (bottom)
- [ ] Resizable divider between them
- [ ] Both panels visible (no tabs on left)
- [ ] Right sidebar unchanged (tabs)

### P5: TimeRoot Hidden
- [ ] TimeRoot blocks filtered from Table View
- [ ] TimeRoot block types not in Library
- [ ] Demo patch time blocks have timeRoot role

### P6: Delete RailId
- [ ] RailId type removed from src/types/index.ts
- [ ] No references to RailId in codebase
- [ ] TypeScript compiles clean

## Verification

### Automated
- [ ] TypeScript compiles without errors (`npm run typecheck`)
- [ ] All tests pass (`npm run test`)

### Manual (Runtime)
- [ ] Table shows connection matrix correctly
- [ ] Time blocks not visible in any UI
- [ ] Buses shown in separate section
- [ ] Split layout works with resizable divider
- [ ] displayName shown in row/column headers

## Out of Scope (Deferred)
- Variadic ports
- DefaultSource display
- Block type preview in Inspector
- Domain propagation logic
- Editing capabilities

# Evaluation: Gap Analysis — C-9 Blocker Reassessment
Timestamp: 2026-01-25T22:05:00Z
Git Commit: 2547345 (branch: ralphie)

## Executive Summary
Overall: C-9 is NOW UNBLOCKED | Tests: 1284/1284 pass | Sprint plan STALE

The sprint plan `SPRINT-20260124-190000-p2-blocked-PLAN.md` is **no longer accurate** for C-9. All ms5.8 blockers (ms5.4, ms5.5, ms5.7, ms5.15) are resolved. The v2 assembly path is complete and tested. The remaining work for ms5.8 is:
1. Wire v2 into ScheduleExecutor (switch executeFrame from assembleRenderPass to assembleRenderFrame_v2)
2. Add DrawPrimitiveInstancesOp support to SVGRenderer
3. Remove v1 assembly path

## Runtime Check Results
| Check | Status | Output |
|-------|--------|--------|
| Test suite | PASS | 1284/1284 green |
| v2 assembly code exists | PASS | assembleRenderFrame_v2 at RenderAssembler.ts:1219 |
| v2 Canvas2D renderer exists | PASS | renderFrameV2 at Canvas2DRenderer.ts:343 |
| v2 SVG renderer exists | PARTIAL | render() at SVGRenderer.ts:202 — missing DrawPrimitiveInstancesOp |
| v2 wired into execution | FAIL | ScheduleExecutor.ts:310 still calls assembleRenderPass (v1) |
| ms5.8 blockers | ALL RESOLVED | ms5.4, ms5.5, ms5.7, ms5.15 all done |

## Findings

### C-9: RenderPassIR -> DrawPathInstancesOp Migration
**Status**: PARTIAL — blockers resolved, switchover not done
**Evidence**:
- `src/runtime/ScheduleExecutor.ts:310` — still calls `assembleRenderPass` (v1 path)
- `src/runtime/RenderAssembler.ts:1219` — `assembleRenderFrame_v2` exists, tested, never called from execution
- `src/render/Canvas2DRenderer.ts:343` — `renderFrameV2` ready, handles both drawPath and drawPrimitive
- `src/render/SVGRenderer.ts:202` — `render()` only handles drawPathInstances, NOT drawPrimitiveInstances

**Issues**:
1. **SVG gap**: SVGRenderer.render() silently skips DrawPrimitiveInstancesOp (no else branch, no warning). Line 206-209 only checks for `drawPathInstances`.
2. **Dual path debt**: Two complete parallel implementations exist. v1 is the live path; v2 is tested but dead code in production.
3. **No feature flag or incremental switchover mechanism**: The migration is all-or-nothing.

### C-8: EventPayload Design
**Status**: BLOCKED (unchanged)
**Evidence**: No new work on event model. Still needs architectural design.

### C-12: PathStyle blend/layer
**Status**: BLOCKED (unchanged)
**Evidence**: Still blocked by U-21 (layer system design).

## ms5.8 Concrete Next Steps

The ms5.8 migration is now actionable. Here is the precise work breakdown:

### Step 1: SVG Primitive Support (prerequisite)
- Add `renderDrawPrimitiveInstancesOp()` to SVGRenderer
- Wire it into `render()` method alongside drawPathInstances
- Model after Canvas2DRenderer's `renderDrawPrimitiveInstancesOp` pattern
- **File**: `src/render/SVGRenderer.ts`
- **Complexity**: LOW — pattern already established in Canvas2D

### Step 2: Wire v2 into ScheduleExecutor
- Change `executeFrame` to collect StepRender[] and call `assembleRenderFrame_v2`
- Change return type from `RenderFrameIR` to `RenderFrameIR_Future`
- **File**: `src/runtime/ScheduleExecutor.ts` (line 300-315)
- **Complexity**: MEDIUM — requires updating the frame return type and all consumers

### Step 3: Update Consumers
- Canvas2DRenderer: already has `renderFrameV2` — just wire the call site
- SVGRenderer: already has `render()` — just wire the call site
- Any integration/test code that calls the old v1 API
- **Files**: Wherever RenderFrameIR is consumed
- **Complexity**: MEDIUM — grep for RenderFrameIR usage

### Step 4: Remove v1 Path
- Delete `assembleRenderPass` from RenderAssembler
- Delete `renderPass`, `renderInstances2D` from Canvas2DRenderer
- Delete `renderV1`, `renderPassIR` from SVGRenderer
- Remove `RenderPassIR` interface from ScheduleExecutor
- **Complexity**: LOW — pure deletion once step 2-3 verified

### Step 5: Rename and Cleanup
- `RenderFrameIR_Future` -> `RenderFrameIR` (it's no longer "future")
- `future-types.ts` -> merge into main types or rename
- Remove "CURRENT STATE: Definition only" comments
- **Complexity**: LOW — cosmetic

## Ambiguities Found
| Area | Question | How LLM Guessed | Impact |
|------|----------|-----------------|--------|
| SVG primitives | How to render drawPrimitiveInstances in SVG? | Didn't handle it (silent skip) | Primitives invisible in SVG after switchover |
| Frame type change | Should v2 be opt-in (flag) or hard switch? | Not decided | All-or-nothing switchover has regression risk |
| Performance | Is v2 assembly faster or slower than v1? | Unknown | Could regress rendering perf |

## Sprint Plan Assessment

**SPRINT-20260124-190000-p2-blocked-PLAN.md**: STALE for C-9
- C-9 is no longer BLOCKED. Its blockers (ms5.4, ms5.5, ms5.7, ms5.15) are all resolved.
- C-9 is now ACTIONABLE with concrete 5-step breakdown above.
- C-8 and C-12 remain BLOCKED (no change).

## Recommendations
1. **Update sprint plan**: C-9 should move from BLOCKED to ACTIONABLE
2. **Start with SVG primitive support**: Smallest discrete step, unblocks the rest
3. **Consider incremental switchover**: Add a flag to executeFrame that toggles v1/v2, prove v2 parity, then remove v1
4. **Add render parity tests**: Before switching, assert that v1 and v2 produce equivalent visual output for the same inputs

## Verdict
- [x] CONTINUE - C-9 blockers resolved, next steps clear
- [ ] PAUSE - No ambiguities blocking progress

```
Workflow: CONTINUE
Next action: Implement SVGRenderer.renderDrawPrimitiveInstancesOp(), then wire v2 into ScheduleExecutor
```

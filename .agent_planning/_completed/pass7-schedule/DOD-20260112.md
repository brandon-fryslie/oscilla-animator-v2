# Definition of Done: Pass 7 Schedule Construction

Generated: 2026-01-12
**Status: COMPLETE** - All criteria verified on 2026-01-12

## Required Acceptance Criteria

All criteria must pass for sprint completion.

### P0: Generate Render Steps

- [x] `pass7Schedule()` returns `ScheduleIR` with non-empty `steps` array
- [x] Each render block (capability === 'render') produces exactly one `StepRender`
- [x] Test assertion `schedule.steps.length > 0` passes (verified via runtime)

### P1: Wire Render Inputs

- [x] `StepRender.position` is a valid `FieldExprId` from the 'pos' input
- [x] `StepRender.color` is a valid `FieldExprId` from the 'color' input
- [x] `StepRender.size` is a valid ID if wired, undefined otherwise
- [x] Inputs correctly traced through `validated.edges` to `blockOutputs`

### P2: Domain Resolution

- [x] `StepRender.domain` is a valid `DomainId`
- [x] Domain exists in `schedule.domains` map
- [x] Runtime materializes correct particle count (5000 for demo)

## Verification Commands

```bash
# Type check
npm run typecheck  # PASSING

# Run tests
npm run test  # Some pre-existing failures (not Pass 7 related)

# Manual verification
npm run dev
# Open browser - should see animated particles  # WORKING
```

## Success Evidence

1. **Console shows**: `[main] Compile result: ok` ✓
2. **Console shows**: `Compiled: 17 signals, 27 fields, 0 slots` (slots are runtime-internal)
3. **Canvas renders**: Animated particle system visible ✓
4. **No errors**: No runtime errors after "Starting animation loop..." ✓

## Implementation Notes

### Commits
- `64082b2` feat(compiler): implement pass7-schedule render step generation
- `cf211d6` fix(runtime): add missing kernels and fix canvas callback timing

### Additional Fixes Required
During implementation, we discovered:
1. **Canvas callback timing bug** - App.tsx was using a ref with delayed useEffect, causing canvas to be undefined when animation started. Fixed by calling onCanvasReady directly.
2. **Missing runtime kernels** - Several field kernels were missing from the Materializer (fieldGoldenAngle, fieldAngularOffset, fieldRadiusSqrt, fieldAdd, fieldPolarToCartesian, fieldPulse, fieldHueFromPhase, fieldJitter2D, hsvToRgb). Added all required kernels.

### Deferred Work
- `evalSig` step generation (not needed for MVP)
- `materialize` step generation (render steps call materialize internally)
- `stateWrite` step generation (no stateful blocks in demo)
- Multiple domain support (MVP uses first domain)

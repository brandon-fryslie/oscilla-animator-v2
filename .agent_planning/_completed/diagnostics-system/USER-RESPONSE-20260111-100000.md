# User Response to Diagnostics System Sprint 2 Plan

**Status**: APPROVED

**Date**: 2026-01-11 10:00:00

**User Response**: "yep!"

## Approved Plan Files

The following planning documents were approved for Sprint 2 implementation:

1. **PLAN-20260111-100000.md** - Sprint 2 implementation plan with 4 deliverables
2. **DOD-20260111-100000.md** - Definition of done with 27 acceptance criteria
3. **CONTEXT-20260111-100000.md** - Implementation context with file locations and patterns

## Sprint 2 Deliverables (Approved)

### Deliverable 1: Runtime Health Monitoring (P0)
- RuntimeHealthSnapshot events at configurable rate (100ms-1000ms)
- NaN/Infinity detection (batched in 100ms windows, configurable toggles)
- Frame budget monitoring (configurable threshold 8ms-100ms)
- New diagnostic codes: P_NAN_DETECTED, P_INFINITY_DETECTED, P_FRAME_BUDGET_EXCEEDED

**Acceptance Criteria**: 5 criteria covering event emission, batching, diagnostics integration, and UI display

### Deliverable 2: Diagnostics Settings Panel (P1)
- DiagnosticsSettingsStore with localStorage persistence
- DiagnosticsSettingsPanel UI component with sliders, toggles, dropdowns
- Configurable settings:
  - Runtime health enabled/disabled
  - Health snapshot interval (100ms-1000ms slider)
  - NaN/Inf detection toggles
  - Frame budget threshold (8ms-100ms slider)
  - Target FPS selector (30/60/120) with auto-threshold adjustment
  - Bus warnings enabled/disabled
  - Individual bus warning type toggles
- Reset to defaults button
- Immediate application via MobX reactivity

**Acceptance Criteria**: 11 criteria covering persistence, UI controls, reactivity, and functionality

### Deliverable 3: Bus Validation Warnings (P2)
- Bus usage analysis in compiler
- W_BUS_EMPTY: Publishers but no listeners
- W_BUS_NO_PUBLISHERS: Listeners but no publishers (silent value)
- Respects settings: busWarningsEnabled, warnEmptyBuses, warnNoPublishers
- Only generated after successful compilation

**Acceptance Criteria**: 5 criteria covering diagnostic generation, UI display, timing, and test coverage

### Deliverable 4 (Optional): Basic Quick Fix - createTimeRoot (P3)
- DiagnosticAction interface expansion (kind, data fields)
- executeAction() function for action execution
- "Create TimeRoot" action for E_TIME_ROOT_MISSING
- DiagnosticActions UI component
- Action buttons inline with diagnostics

**Acceptance Criteria**: 5 criteria covering action execution, block creation, diagnostic resolution, undo, and UI

## Key Design Decisions (Approved)

1. **User configurability**: All intervals, thresholds, and toggles configurable via settings panel
2. **Settings persistence**: localStorage for cross-session persistence
3. **NaN batching**: 100ms windows (configurable nanBatchWindowMs)
4. **Health snapshot rate**: 100ms-1000ms range (1-10 Hz)
5. **Frame budget threshold**: 8ms-100ms range, auto-adjusted by target FPS
6. **Bus warnings timing**: Compile-time only (after successful compilation)
7. **Settings application**: Immediate via MobX reactivity (no save button)

## Scope Clarifications

**In scope (Sprint 2)**:
- Runtime health monitoring with configurable intervals/thresholds
- Diagnostics settings panel with full UI
- Bus validation warnings (empty buses, no publishers)
- Optional: createTimeRoot quick fix

**Explicitly out of scope (Sprint 3+)**:
- Advanced quick fixes (addAdapter, removeBlock, muteDiagnostic)
- UI badges on blocks/ports/buses
- Diagnostic grouping and muting
- Field materialization diagnostics
- Combine mode conflict detection (W_BUS_COMBINE_CONFLICT)
- Semantic path resolution

## Files to Create (10)

1. `src/runtime/HealthMonitor.ts` - Health snapshot generation
2. `src/stores/DiagnosticsSettingsStore.ts` - Settings store with persistence
3. `src/ui/components/settings/DiagnosticsSettingsPanel.tsx` - Settings UI
4. `src/compiler/passes/busValidation.ts` - Bus warning generation
5. `src/diagnostics/actions/quickFixes.ts` - Quick fix executors (optional P3)
6. `src/ui/components/diagnostics/DiagnosticActions.tsx` - Action UI (optional P3)
7. `src/diagnostics/__tests__/runtimeDiagnostics.test.ts` - Runtime tests
8. `src/compiler/__tests__/busValidation.test.ts` - Bus validation tests
9. `src/diagnostics/__tests__/DiagnosticsSettingsStore.test.ts` - Settings tests
10. `src/diagnostics/__tests__/quickFixes.test.ts` - Quick fix tests (optional P3)

## Files to Modify (9)

1. `src/main.ts` - Integrate health monitoring in animation loop
2. `src/runtime/RuntimeState.ts` - Add HealthMetrics interface
3. `src/runtime/SignalEvaluator.ts` - Add NaN/Inf detection
4. `src/compiler/compile.ts` - Bus validation integration
5. `src/diagnostics/types.ts` - Add diagnostic codes (P_*, W_*) and expand DiagnosticAction
6. `src/diagnostics/validators/authoringValidators.ts` - Add actions to E_TIME_ROOT_MISSING
7. `src/stores/RootStore.ts` - Add DiagnosticsSettingsStore
8. `src/runtime/HealthMonitor.ts` - Read settings from store
9. `src/ui/components/app/App.tsx` - Add settings panel to UI

## Estimated Effort

**P0 (Runtime Health)**: 16-20 hours
**P1 (Settings Panel)**: 8-12 hours
**P2 (Bus Warnings)**: 8-12 hours
**P3 (Quick Fix - Optional)**: 6-8 hours

**Total Sprint 2**: 32-44 hours (P0+P1+P2), 38-52 hours with P3

## Acceptance Criteria Summary

**Total**: 27 acceptance criteria
- **Required (P0-P2)**: 22 criteria
- **Optional (P3)**: 5 criteria

**Breakdown**:
- Deliverable 1 (Runtime Health): 5 criteria
- Deliverable 2 (Settings Panel): 11 criteria
- Deliverable 3 (Bus Warnings): 5 criteria
- Deliverable 4 (Quick Fix): 5 criteria (optional)

## Next Step

Proceed to implementation using `/do:it diagnostics-system Sprint 2`

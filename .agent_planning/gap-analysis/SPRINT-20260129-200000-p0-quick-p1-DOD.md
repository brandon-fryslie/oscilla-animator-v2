# Definition of Done: p0-quick-p1
Generated: 2026-01-29-200000
Status: READY FOR IMPLEMENTATION
Plan: SPRINT-20260129-200000-p0-quick-p1-PLAN.md

## Acceptance Criteria

### P0: Fix unitVar Crash
- [ ] All 5 unitVar() calls in src/blocks/ replaced with concrete unit constructors
- [ ] `npx vitest run` no longer shows "unitVar() removed per D5" in any failure output
- [ ] 50+ previously-crashing test files now import successfully
- [ ] `npx tsc --noEmit` exits 0

### P1 #1: Fix Broken Canonical Type Tests
- [ ] `npx vitest run src/core/__tests__/canonical-types.test.ts` passes (0 failures)
- [ ] No `'instantiated'` string literal in any test file under src/

### P1 #5: Delete AxisTag Alias
- [ ] `grep -r 'AxisTag' src/` returns zero matches
- [ ] `npx tsc --noEmit` exits 0

### P1 #8: cameraProjection Closed Enum
- [ ] `CameraProjection` type exported from src/core/canonical-types.ts
- [ ] `cameraProjectionConst('invalid_string')` would fail TypeScript type check
- [ ] ConstValue cameraProjection variant uses CameraProjection, not string

### P1 #9: tryDeriveKind
- [ ] Function exported from src/core/canonical-types.ts
- [ ] Returns DerivedKind for fully-instantiated types
- [ ] Returns null for types with var axes
- [ ] At least 2 unit tests (inst -> kind, var -> null)

### P1 #11: AxisViolation Field Rename
- [ ] AxisViolation has `nodeIndex: number` and `nodeKind: string`
- [ ] No remaining `typeIndex` in axis-validate.ts or consumers
- [ ] TypeScript compiles cleanly

### P1 #12: deriveKind Agreement Asserts
- [ ] Assert at lowering boundary checks tag === deriveKind(type)
- [ ] Test demonstrating assert catches intentional mismatch

### P1 #13: CI Forbidden-Pattern Test
- [ ] Test file exists in src/core/__tests__/ or equivalent
- [ ] Test scans src/ for at least 3 forbidden patterns
- [ ] Test passes on current codebase (post-fixes)
- [ ] Test would fail if forbidden pattern were reintroduced

## Overall Sprint Completion
- [ ] `npx tsc --noEmit` exits 0
- [ ] `npx vitest run` shows significant improvement in pass rate (target: recover 45+ of the 50 failing files)
- [ ] No regressions in the 74 previously-passing test files

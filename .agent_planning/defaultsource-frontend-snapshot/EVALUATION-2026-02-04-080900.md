# Evaluation: Frontend Snapshot UI Wiring (Phase 2)

**Date**: 2026-02-04T08:09:00
**Scope**: Wire FrontendResultStore to live UI rendering path
**Branch**: bmf_type_system_refactor

## Situation

The backend is done: `FrontendResultStore`, `RootStore.frontend`, `CompileOrchestrator` frontend-first flow, `compile()` precomputed path — all working, 2163 tests passing.

The UI wiring is **broken** because the previous sprint wired `FrontendResultStore` into the **wrong rendering path**:
- `nodes.ts` + `sync.ts` (old path, dead code — never called by live app)
- The live path is `GraphEditorCore.tsx` + `nodeDataTransform.ts` + `PatchStoreAdapter.ts`

Additionally, `PatchStoreAdapter` was modified to require `FrontendResultStore` in its constructor, but two callers were not updated, causing **typecheck failures**.

## Persistent Checks

| Check | Status | Notes |
|-------|--------|-------|
| `npm run typecheck` | **FAIL** | 2 errors: `ReactFlowEditor.tsx:127` and `PatchStoreAdapter.test.ts:26` pass 2 args, constructor needs 3 |
| `npm run test` | PASS | 2163 passed (tests don't exercise the broken constructor sites) |

## Issues Found

### BUILD-BREAKING: Constructor mismatch (2 sites)

`PatchStoreAdapter` constructor was changed to require `(patchStore, layoutStore, frontendStore)` but two call sites still pass only 2 args:
1. `src/ui/reactFlowEditor/ReactFlowEditor.tsx:127`
2. `src/ui/graphEditor/__tests__/PatchStoreAdapter.test.ts:26`

### INCOMPLETE: MobX reaction doesn't observe data-only changes

`GraphEditorCore.tsx:466` reaction tracks structural keys (`blockCount`, `edgeCount`, `blockIds`, `edgeIds`). When frontend snapshot changes (port types, default sources), block IDs don't change, so the reaction never fires. The old `sync.ts` had `frontendSnapshotRevision` and `frontendSnapshotStatus` in its reaction — but that code is dead.

### INCOMPLETE: Resolved port types not flowing to live path

`InputPortLike` / `OutputPortLike` in `types.ts` have no `resolvedType` field. The live `nodeDataTransform.ts:createNodeFromBlockLike()` uses `inputDef.type` (registry type). `PatchStoreAdapter.transformInputPorts()` populates `defaultSource` but not resolved types.

### DEAD CODE: sync.ts and most of nodes.ts

- `sync.ts`: Zero imports from anywhere in `src/`. Entire file is dead.
- `nodes.ts`: Only `OscillaEdgeData` type is imported by live code (by `nodeDataTransform.ts` and `OscillaEdge.tsx`). All functions are dead. `OscillaNodeData`, `PortData`, `OscillaNode` types are used only by `OscillaNode.tsx` and `PortInfoPopover.tsx` (legacy node component, not used by live `UnifiedNode.tsx` path).

### BUG (masked): getEffectiveDefaultSource() logic flaw

In `nodes.ts:112-135`, when frontend snapshot is active and says a port has no default source, the function falls through to registry default instead of returning `undefined`. Masked by `isConnected` check in UI. This is dead code in the live path, but if we're keeping the function, it should be fixed or deleted.

## Verdict: CONTINUE

The work is well-scoped with a clear handoff. The previous sprint's evaluation identified the exact problems. This is a focused fix sprint:
1. Fix the constructor mismatch (build-breaking)
2. Add `resolvedType` to `InputPortLike`/`OutputPortLike` and populate from adapter
3. Fix MobX reaction to observe data changes
4. Delete dead code
5. Verify all tests + typecheck pass

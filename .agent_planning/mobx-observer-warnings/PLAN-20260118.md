# Plan: Fix MobX Observer Warnings

**Topic**: mobx-observer-warnings
**Created**: 2026-01-18
**Status**: READY FOR APPROVAL

## Problem Summary

Browser console shows MobX warnings:
```
[mobx] Derivation 'observer' is created/updated without reading any observable value.
```

## Root Cause

**CanvasTab.tsx** - This component uses `rootStore.viewport` methods (`setZoom`, `panBy`, `resetView`) but is NOT wrapped with `observer()`. While it doesn't need to react to viewport changes for its own rendering, the fact that it accesses MobX state in event handlers is creating these warnings.

## Solution Strategy

### Option A: Wrap CanvasTab with observer (RECOMMENDED)
Even though CanvasTab doesn't render observable values directly, wrapping it with `observer()` will:
- Eliminate the MobX warning
- Make the component properly reactive if we later add reactive rendering
- Follow the pattern "any component that touches MobX state should be an observer"
- Be consistent with other components in the codebase

### Option B: Don't wrap, suppress warnings
We could leave it unwrapped since it's only *mutating* state in event handlers, not *reading* it in render. However, this doesn't follow best practices and the warning will persist.

**Decision: Go with Option A**

## Implementation Plan

### Step 1: Wrap CanvasTab with observer
**File**: `src/ui/components/app/CanvasTab.tsx`
**Changes**:
1. Import `observer` from `mobx-react-lite` (line 8)
2. Wrap the component export with `observer()`

### Step 2: Verify fix using Chrome DevTools
1. Launch Chrome with remote debugging via MCP
2. Navigate to localhost:5175
3. Open DevTools console
4. Reload page
5. Verify no MobX warnings appear
6. Test all interactions:
   - Mouse wheel zoom
   - Click and drag pan
   - Double-click reset
7. Verify no warnings during interactions

### Step 3: Search for any other unwrapped components
Run a comprehensive search for:
- Components that use `rootStore.*` but aren't wrapped with observer
- Components that access MobX state in callbacks/effects but not in render

### Step 4: Document the pattern
Add a note to CLAUDE.md or create a linting rule:
> "Any component that accesses MobX stores (even in callbacks/effects) should be wrapped with `observer()`"

## Verification Criteria

**Success** means:
1. ✅ No MobX warnings in console on page load
2. ✅ No MobX warnings during any user interactions
3. ✅ All canvas interactions still work correctly
4. ✅ TypeScript compiles with no errors
5. ✅ All existing tests pass

**Failure** would be:
- ❌ MobX warnings still appearing
- ❌ Canvas interactions broken
- ❌ TypeScript errors introduced
- ❌ Tests failing

## Files to Modify

1. `src/ui/components/app/CanvasTab.tsx` - Wrap with observer
2. (Potentially) Other components discovered in Step 3

## Risk Assessment

**Low Risk**:
- This is a standard MobX pattern
- No behavior changes, only reactivity addition
- Easy to verify and rollback if needed
- No API changes

## Alternative Considered

We could also:
- Extract viewport manipulation to a custom hook
- Use runInAction() for mutations
- Create a separate ViewportController class

But these are over-engineering for this simple case. The observer wrapper is the idiomatic MobX solution.

## Follow-up Work

After this fix, consider:
1. Adding ESLint rule to catch unwrapped components accessing MobX stores
2. Audit all components for consistent observer usage
3. Document MobX patterns in project guidelines

# Evaluation: User Editable Block Display Names

**Generated**: 2026-01-27T18:00:00Z
**Topic**: User editable block display names
**Verdict**: CONTINUE

## Current State Analysis

### Existing Infrastructure

1. **Block.displayName field** (`src/graph/Patch.ts:141`)
   - Already exists: `readonly displayName: string | null;`
   - Currently optional (null allowed)
   - Used throughout codebase for display purposes

2. **canonical-name.ts utilities** (`src/core/canonical-name.ts`)
   - `normalizeCanonicalName()` - converts displayName to canonical form
   - `detectCanonicalNameCollisions()` - finds collisions
   - `validateDisplayNameUniqueness()` - validates patch for collisions
   - `isValidDisplayName()` - validates non-empty string

3. **PatchStore.updateBlockDisplayName()** (`src/stores/PatchStore.ts:307-319`)
   - Already implemented
   - Updates block displayName and invalidates snapshot

4. **BlockInspector DisplayNameEditor** (`src/ui/components/BlockInspector.tsx:855-926`)
   - Already has double-click to edit functionality
   - Uses inline editing pattern
   - Commits on blur/Enter, cancels on Escape

5. **OscillaNode component** (`src/ui/reactFlowEditor/OscillaNode.tsx`)
   - Shows `data.label` which is set from `block.displayName || blockDef.label`
   - No inline editing currently

6. **nodes.ts createNodeFromBlock** (`src/ui/reactFlowEditor/nodes.ts:195`)
   - Sets `label: block.displayName || blockDef.label`
   - Fallback to blockDef.label when no displayName

### Gap Analysis

| Requirement | Current State | Gap |
|-------------|---------------|-----|
| ALL blocks require displayName | displayName is `string | null` | Must generate default on creation |
| Default pattern: "<Type> <n>" | No auto-generation | Need to implement counter logic |
| Inline editing in ReactFlow | Not implemented | Need to add editable label to OscillaNode |
| Edit in Block Inspector | Implemented | Working |
| Use canonical-name.ts utilities | Utilities exist | Need to integrate for validation |
| Collision detection | Utilities exist | Need to surface validation errors |

### Architectural Observations

1. **Single Source of Truth**: PatchStore.blocks is authoritative
2. **displayName vs label**: Block.label is legacy, displayName is the standard
3. **Canonical name normalization**: Already handles case-insensitivity and special chars
4. **Validation exists but unused**: `validateDisplayNameUniqueness` not called on block add

## Scope Confirmation

### In Scope
- Auto-generate displayName on block creation: "<BlockDef.label> <n>"
- Inline editing in ReactFlow nodes (OscillaNode.tsx)
- Validation integration (collision detection)
- Make displayName required (no more null)

### Out of Scope
- Bulk rename operations
- History/undo for name changes (handled by existing undo system)
- Name suggestions/autocomplete

## Technical Approach

### 1. Block Creation - Auto-generate DisplayName

Modify `PatchStore.addBlock()` to:
1. Count existing blocks of same type
2. Generate `"${blockDef.label} ${count + 1}"`
3. Check for collisions, increment if needed

### 2. ReactFlow Inline Editing

Modify `OscillaNode.tsx` to:
1. Make label double-clickable to edit
2. Show input field on edit mode
3. Commit on blur/Enter
4. Validate and show error on collision

### 3. Validation Integration

Add validation in:
1. Block creation (auto-resolve collisions)
2. DisplayName update (show error on collision)
3. Patch load (warn on collisions)

## Risk Assessment

| Risk | Likelihood | Mitigation |
|------|------------|------------|
| Breaking existing patches | Low | displayName already exists, just null-able |
| Collision on auto-generate | Low | Counter increment handles this |
| Performance with many blocks | Low | Simple string operations |

## Verdict: CONTINUE

All infrastructure exists. Implementation is straightforward extension of existing patterns.

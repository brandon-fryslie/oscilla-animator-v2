Agent: iterative-implementer | 2026-01-17 05:10:31
Mode: manual
Completed: Sprint 6 - Compiler Passes Migration | Files: 5 | Commits: 3
Tests: 11 passing (instance-unification.test.ts)
Cache invalidated: None (no cache entries for compiler IR structure)
Status: complete

## Sprint 6: Compiler Passes Migration - COMPLETE

### Summary
Successfully migrated compiler passes from domain-based to instance-based model.
All type changes propagated through compiler pipeline. Tests updated and passing.

### Changes Made

**Part 1-3: Type & Pass Updates (Commit 6bd8299)**
- Updated StepMaterialize: domain → instanceId
- Updated StepRender: domain → instanceId
- Updated IRProgram: domains → instances
- Updated ScheduleIR: domains → instances
- Updated pass7-schedule.ts to use getInstances() instead of getDomains()
- Exported InstanceId type from ir/types.ts

**Part 4: Test Rename (Commit ccc0eb9)**
- Renamed domain-unification.test.ts → instance-unification.test.ts
- Updated test suite name and comments
- Tests validate behavior (domain unification logic), not implementation

**Part 5: Test Updates (Commit c51e417)**
- Updated compile.test.ts: schedule.domains → schedule.instances
- Updated steel-thread.test.ts: schedule.domains → schedule.instances
- Updated expectations to check instance properties (count, layout)

### Files Modified
1. src/compiler/ir/types.ts - Step types, IRProgram, InstanceId export
2. src/compiler/passes-v2/pass7-schedule.ts - ScheduleIR, buildRenderSteps
3. src/compiler/__tests__/compile.test.ts - Test assertions
4. src/compiler/__tests__/steel-thread.test.ts - Test assertions
5. src/compiler/__tests__/instance-unification.test.ts - Comments/naming

### Verification

**Type Check**: Compiler passes clean
- No errors in src/compiler/**
- Expected errors in src/runtime/** (Sprint 7 will fix)
- Unrelated errors in src/ui/** (block registry API changes)

**Tests**: Instance unification tests passing
- 11/11 tests pass in instance-unification.test.ts
- Tests validate domain unification behavior (unchanged)
- compile.test.ts and steel-thread.test.ts have pre-existing block registration error (FieldRadiusSqrt)

### Cache Invalidation
No invalidation needed - no eval-cache entries exist for compiler IR structure.
Existing cache entries cover runtime UI components only.

### What NOT Changed (Per Sprint Instructions)
- Runtime (src/runtime/**) - Sprint 7 will migrate
- Old types in canonical-types - Sprint 8 will delete
- All other tests - Sprint 8 will update

### Next Steps (Sprint 7)
- Update runtime to use instanceId instead of domain
- Migrate ScheduleExecutor to use instances map
- Update runtime to handle instance-based steps

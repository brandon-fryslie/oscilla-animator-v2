# Context: Auto-Arrange Layout

**Bead:** `oscilla-animator-v2-8fp`
**Date:** 2026-01-18

---

## Background

After removing Rete.js, the React Flow editor lacks automatic graph layout functionality. Rete had `rete-auto-arrange-plugin` with ELK algorithm that arranged nodes in a clean left-to-right flow.

Users currently must manually position nodes, which is tedious for graphs with many nodes.

## Current State

- React Flow editor is the sole node editor
- Nodes are positioned in a simple grid layout on sync from PatchStore
- No auto-arrange functionality exists
- `EditorHandle` interface has optional `autoArrange?()` method (not implemented)

## Requirements

- On-demand layout (user clicks button)
- Left-to-right layered layout (sources on left, sinks on right)
- Support for dozens of nodes
- ELKjs library (more powerful than dagre, same as Rete used)

## Key Files

- `src/ui/reactFlowEditor/ReactFlowEditor.tsx` - Main editor component
- `src/ui/reactFlowEditor/ReactFlowEditor.css` - Editor styles
- `src/ui/reactFlowEditor/nodes.ts` - Node type definitions
- `src/ui/editorCommon/EditorHandle.ts` - Editor interface

## Technical Notes

- ELK options from Rete implementation:
  - `elk.algorithm: 'layered'`
  - `elk.direction: 'RIGHT'`
  - `elk.spacing.nodeNode: '100'`
  - `elk.layered.spacing.nodeNodeBetweenLayers: '80'`
- Default node dimensions: 200x120 (approximate OscillaNode size)
- React Flow's `useReactFlow` hook provides `fitView()` for post-layout zoom

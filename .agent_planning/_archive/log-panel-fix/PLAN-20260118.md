# Log Panel Fix - Implementation Plan

**Date**: 2026-01-18
**Topic**: log-panel-fix
**Confidence**: HIGH (95%)

## Overview

This is a straightforward integration task. The LogPanel component already exists and is functional. We just need to wire it into the Dockview panel system following the established pattern used by all other panels.

## Implementation Steps

### Step 1: Create Dockview Panel Wrapper

**File**: `src/ui/dockview/panels/LogPanel.tsx` (NEW)

**Action**: Create new file following the exact pattern of `DiagnosticConsolePanel.tsx`

```typescript
/**
 * Log Panel Wrapper
 *
 * Wraps LogPanel component for Dockview.
 */

import React from 'react';
import type { IDockviewPanelProps } from 'dockview';
import { LogPanel as LogPanelComponent } from '../../components/app/LogPanel';

export const LogPanel: React.FC<IDockviewPanelProps> = () => {
  return <LogPanelComponent />;
};
```

**Rationale**:
- Follows single source of truth principle (one wrapper per panel)
- Matches existing pattern exactly
- Import renamed to avoid name collision

**Risk**: NONE - Simple boilerplate following established pattern

---

### Step 2: Register Panel in Panel Registry

**File**: `src/ui/dockview/panelRegistry.ts`

**Action A**: Add import at top of file

```typescript
import { LogPanel } from './panels/LogPanel';
```

**Action B**: Add panel definition to `PANEL_DEFINITIONS` array (after diagnostic-console)

```typescript
  // Bottom (split)
  { id: 'diagnostic-console', component: 'diagnostic-console', title: 'Console', group: 'bottom-left' },
  { id: 'log-panel', component: 'log-panel', title: 'Logs', group: 'bottom-left' },  // NEW
```

**Action C**: Add component mapping to `PANEL_COMPONENTS` object

```typescript
export const PANEL_COMPONENTS = {
  'block-library': BlockLibraryPanel,
  'block-inspector': BlockInspectorPanel,
  'table-view': TableViewPanel,
  'connection-matrix': ConnectionMatrixPanel,
  'rete-editor': ReteEditorPanel,
  'flow-editor': ReactFlowEditorPanel,
  'preview': PreviewPanel,
  'diagnostic-console': DiagnosticConsolePanel,
  'log-panel': LogPanel,  // NEW
};
```

**Rationale**:
- Single source of truth for all panel definitions
- Placing in `'bottom-left'` group creates tab alongside Console
- Array order determines tab order (Console first, Logs second)

**Risk**: NONE - Pure data structure update

---

### Step 3: Add Panel to Default Layout

**File**: `src/ui/dockview/defaultLayout.ts`

**Action**: The panel will be automatically added by the existing code

**Current code** (lines 177-193):
```typescript
  // Add bottom-left panels (Diagnostics, etc.)
  bottomLeftPanels.forEach((panel, index) => {
    api.addPanel({
      id: panel.id,
      component: panel.component,
      title: panel.title,
      position: {
        referenceGroup: groups['bottom-left'].id,
        direction: 'within',
      },
    });

    if (index === 0) {
      const addedPanel = api.getPanel(panel.id);
      addedPanel?.api.setActive();
    }
  });
```

**How it works**:
- `bottomLeftPanels` is filtered from `PANEL_DEFINITIONS` where `group === 'bottom-left'`
- The loop automatically adds all panels to the bottom-left group
- First panel (Console) is set as active by default
- Second panel (Logs) will be available as a tab

**Rationale**:
- No code changes needed - declarative system works automatically
- Adding to `PANEL_DEFINITIONS` is sufficient
- Demonstrates proper separation of concerns

**Risk**: NONE - Existing code handles this correctly

---

## Verification Steps

### Step 1: TypeScript Compilation
```bash
npm run typecheck
```
**Expected**: No errors

### Step 2: Build
```bash
npm run build
```
**Expected**: Clean build

### Step 3: Development Server
```bash
npm run dev
```
**Expected**: Application starts without errors

### Step 4: Visual Verification
1. Open application in browser
2. Look at bottom panel
3. Verify two tabs visible: "Console" and "Logs"
4. Click "Logs" tab
5. Verify LogPanel component renders
6. Check browser console for errors/warnings

### Step 5: Functional Testing
1. Trigger some log messages (if possible)
2. Verify they appear in Logs panel
3. Verify auto-scroll works
4. Test panel resize
5. Test switching between tabs

---

## Risk Assessment

**Overall Risk**: VERY LOW

### Why Low Risk?

1. **No Logic Changes**: Pure integration, no new functionality
2. **Established Pattern**: Following exact pattern used by 8 other panels
3. **No Dependencies**: Changes are isolated to 2 files
4. **Declarative System**: Layout engine handles the work automatically
5. **Existing Component**: LogPanel already tested and working

### Potential Issues

**Issue**: LogPanel might not have data initially
- **Impact**: Panel shows empty (expected behavior)
- **Mitigation**: This is correct - logs appear when logged

**Issue**: Import path might be wrong
- **Impact**: TypeScript error
- **Mitigation**: Will catch immediately during typecheck

**Issue**: Name collision between wrapper and component
- **Impact**: Build error
- **Mitigation**: Already handled with renamed import

---

## File Changes Summary

| File | Action | Lines Changed |
|------|--------|---------------|
| `src/ui/dockview/panels/LogPanel.tsx` | CREATE | ~15 |
| `src/ui/dockview/panelRegistry.ts` | MODIFY | +3 |
| `src/ui/dockview/defaultLayout.ts` | NONE | 0 |

**Total**: 1 new file, 1 modified file, ~18 lines of code

---

## Rollback Plan

If issues arise:

1. Remove `log-panel` entry from `PANEL_DEFINITIONS`
2. Remove `'log-panel': LogPanel` from `PANEL_COMPONENTS`
3. Remove import from `panelRegistry.ts`
4. Delete `src/ui/dockview/panels/LogPanel.tsx`

All changes are additive and non-breaking, so rollback is trivial.

---

## Post-Implementation

### Future Enhancements (Out of Scope)

- Log filtering by level (error, warn, info)
- Search/filter logs by text
- Clear logs button
- Export logs to file
- Timestamp format options
- Log level icons

### Maintenance Notes

- LogPanel component lives in `src/ui/components/app/`
- Panel wrapper lives in `src/ui/dockview/panels/`
- Any changes to LogPanel component do not require changes to wrapper
- Wrapper is purely for Dockview integration

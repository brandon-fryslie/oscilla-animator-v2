# Definition of Done: Dual Editor Implementation

**Topic:** dual-editor-reactflow
**Created:** 2026-01-13 21:45

---

## P0: Directory Restructure + EditorHandle Abstraction

- [ ] `src/ui/editor/` renamed to `src/ui/reteEditor/`
- [ ] `src/ui/editorCommon/EditorHandle.ts` exists with generic interface
- [ ] `src/ui/editorCommon/EditorContext.tsx` exists with generic provider
- [ ] `src/ui/editorCommon/index.ts` exports all
- [ ] ReteEditor creates adapter implementing EditorHandle
- [ ] App.tsx imports updated
- [ ] BlockLibrary.tsx imports updated, uses generic handle
- [ ] BlockLibrary.test.tsx imports updated
- [ ] `npm run typecheck` passes
- [ ] `npm run test` passes
- [ ] Existing Rete editor functionality preserved

---

## P1: ReactFlow Editor Core

- [ ] `reactflow` package installed
- [ ] `src/ui/reactFlowEditor/ReactFlowEditor.tsx` exists
- [ ] `src/ui/reactFlowEditor/sync.ts` exists
- [ ] `src/ui/reactFlowEditor/nodes.ts` exists
- [ ] `src/ui/reactFlowEditor/index.ts` exists
- [ ] ReactFlow editor renders nodes from PatchStore
- [ ] Pan works (drag background)
- [ ] Zoom works (scroll wheel)
- [ ] Nodes are draggable
- [ ] Connections can be created by dragging
- [ ] Delete key removes selected nodes
- [ ] ReactFlowEditor implements EditorHandle interface

---

## P2: Tab Integration + Sync

- [ ] 'Rete' tab visible in center panel (renamed from 'Editor')
- [ ] 'Flow' tab visible in center panel (new)
- [ ] Tab switching works without errors
- [ ] Both editors stay mounted during tab switch
- [ ] BlockLibrary double-click adds to visible editor
- [ ] Add node in Rete → appears in Flow after tab switch
- [ ] Add node in Flow → appears in Rete after tab switch
- [ ] Delete node syncs between editors
- [ ] Connections sync between editors
- [ ] No sync loops (no infinite updates)
- [ ] No console errors during operation

---

## Quality Gates

```bash
npm run typecheck  # 0 errors
npm run test       # All pass
npm run build      # Succeeds
```

---

## Feature Parity Matrix

| Feature | Rete | ReactFlow | Required |
|---------|------|-----------|----------|
| Pan | ✓ | ✓ | Yes |
| Zoom | ✓ | ✓ | Yes |
| Add node | ✓ | ✓ | Yes |
| Delete node | ✓ | ✓ | Yes |
| Create connection | ✓ | ✓ | Yes |
| Delete connection | ✓ | ✓ | Yes |
| Minimap | ✓ | - | No (defer) |
| Auto-layout | ✓ | - | No (defer) |
| Undo/redo | ✓ | - | No (defer) |

---

## Out of Scope (NOT Done)

- [ ] ReactFlow minimap (deferred)
- [ ] ReactFlow auto-layout (deferred)
- [ ] ReactFlow undo/redo (deferred)
- [ ] Custom node styling (deferred)

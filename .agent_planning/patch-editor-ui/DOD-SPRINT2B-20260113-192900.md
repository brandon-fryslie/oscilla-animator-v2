# Definition of Done: Sprint 2B - Advanced Editor Features

**Date:** 2026-01-13 19:29
**Topic:** patch-editor-ui Sprint 2B
**Base:** Sprint 2A Complete (commit f043e7b)

---

## Overview

Sprint 2B implements 5 advanced editor features in dependency order:
1. Auto-layout (lowest complexity)
2. Minimap
3. Custom Node Rendering
4. Parameter Control UI (highest complexity, depends on #3)
5. E2E Testing for all features

---

## Feature 1: Auto-layout

### AC1.1: Auto-layout Button
- [ ] Toolbar button "Auto Arrange" visible in editor toolbar
- [ ] Button styled consistently with existing toolbar buttons
- [ ] Tooltip shows "Auto Arrange (arrange nodes automatically)"

### AC1.2: Layout Algorithm
- [ ] Clicking button arranges all nodes with no overlap
- [ ] Layout uses left-to-right flow direction
- [ ] Minimum spacing: 50px horizontal, 40px vertical
- [ ] Layout completes in <500ms for 50 nodes

### AC1.3: Post-Layout Behavior
- [ ] Zoom-to-fit triggers automatically after layout
- [ ] All nodes visible after layout + zoom-to-fit
- [ ] Node positions sync to PatchStore

### AC1.4: Edge Cases
- [ ] Empty graph: No error, no action
- [ ] Single node: Centered, no error
- [ ] 100+ nodes: Completes without timeout

---

## Feature 2: Minimap

### AC2.1: Minimap Display
- [ ] Minimap visible in top-right corner of editor
- [ ] Size: ~180x120px (adjustable)
- [ ] Shows all nodes as simplified representation
- [ ] Connections visible as lines

### AC2.2: Viewport Indicator
- [ ] Current viewport highlighted with rectangle
- [ ] Viewport indicator updates during pan/zoom
- [ ] Clear visual distinction from node representations

### AC2.3: Click-to-Navigate
- [ ] Click on minimap navigates to that region
- [ ] Viewport centers on click location
- [ ] Navigation is smooth (animated)

### AC2.4: Performance
- [ ] Smooth performance with 50+ nodes
- [ ] No perceptible lag during pan/zoom
- [ ] No memory leaks during extended use

---

## Feature 3: Custom Node Rendering

### AC3.1: Custom Node Appearance
- [ ] Nodes have custom styled header with block type
- [ ] Header shows node label prominently
- [ ] Block type badge visible (e.g., "Constant", "Add")
- [ ] Visual distinction from default Rete nodes

### AC3.2: Socket Rendering
- [ ] Input sockets on left side with labels
- [ ] Output sockets on right side with labels
- [ ] Socket colors match socket type (signal/field/domain)
- [ ] Socket connection dots visible

### AC3.3: Interaction Preservation
- [ ] Node selection works (click to select)
- [ ] Node dragging works smoothly
- [ ] Socket drag-to-connect works
- [ ] Socket connections work (same as before)
- [ ] Socket disconnection works
- [ ] Context menu still works (right-click delete)

### AC3.4: Performance
- [ ] Smooth rendering with 50+ custom nodes
- [ ] No perceptible lag during drag/zoom
- [ ] React memoization applied to prevent unnecessary re-renders

---

## Feature 4: Parameter Control UI

### AC4.1: Parameter Controls in Nodes
- [ ] Float parameters: Slider + value display
- [ ] Bool parameters: Checkbox
- [ ] Enum parameters: Dropdown select
- [ ] Parameter labels visible

### AC4.2: Inline Editing
- [ ] Slider drag updates parameter in real-time
- [ ] Checkbox toggle updates parameter immediately
- [ ] Dropdown selection updates parameter immediately
- [ ] Changes are debounced (100ms) to prevent excessive updates

### AC4.3: PatchStore Sync
- [ ] Parameter changes sync to PatchStore
- [ ] PatchStore is single source of truth
- [ ] No sync loops (changes don't echo back)

### AC4.4: BlockInspector Integration
- [ ] Changes in node update BlockInspector display
- [ ] Changes in BlockInspector update node display
- [ ] Bidirectional sync stable and consistent

### AC4.5: Validation
- [ ] Float parameters respect min/max bounds
- [ ] Int parameters accept only integers
- [ ] Enum parameters show only valid options

---

## Feature 5: E2E Testing

### AC5.1: Auto-layout Tests
- [ ] Test: Auto-layout button exists and is clickable
- [ ] Test: Layout produces no overlapping nodes
- [ ] Test: Zoom-to-fit after layout

### AC5.2: Minimap Tests
- [ ] Test: Minimap is visible
- [ ] Test: Click minimap navigates to region

### AC5.3: Custom Rendering Tests
- [ ] Test: Custom nodes display correctly
- [ ] Test: Socket interactions work (connect/disconnect)

### AC5.4: Parameter Tests
- [ ] Test: Parameter control edits sync to PatchStore
- [ ] Test: BlockInspector and node stay in sync

### AC5.5: Regression Tests
- [ ] Test: Sprint 2A features still work (add, delete, undo/redo)
- [ ] All existing tests still pass

---

## Quality Gates

### QG1: Code Quality
- [ ] TypeScript: 0 errors
- [ ] ESLint: No new errors
- [ ] No console errors during normal operation

### QG2: Test Results
- [ ] All new E2E tests pass
- [ ] All existing tests pass (275 currently passing)
- [ ] No test flakiness (3 consecutive runs pass)

### QG3: Performance
- [ ] Editor loads in <2s with 50 nodes
- [ ] Auto-layout <500ms for 50 nodes
- [ ] Pan/zoom maintains 60fps

### QG4: Stability
- [ ] No crashes during normal operation
- [ ] No memory leaks detected
- [ ] All sync operations stable

---

## Implementation Order

**Phase 1:** Auto-layout (Feature 1)
**Phase 2:** Minimap (Feature 2)
**Phase 3:** Custom Node Rendering (Feature 3)
**Phase 4:** Parameter Control UI (Feature 4 - requires Phase 3)
**Phase 5:** E2E Testing (Feature 5 - tests all features)

---

## Success Criteria

Sprint 2B is complete when:
1. All acceptance criteria above are checked off
2. All quality gates pass
3. Manual verification confirms features work
4. No regression in Sprint 2A functionality

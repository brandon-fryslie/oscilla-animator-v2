# Evaluation: Deprecated Cleanup Epic (oscilla-animator-v2-tk2)

**Generated:** 2026-01-27T12:00:00
**Topic:** Clean up deprecated types, overloads, and legacy patterns
**Bead:** oscilla-animator-v2-tk2

## Verdict: CONTINUE

All child tasks are well-defined with clear scope and acceptance criteria. No blockers or ambiguities found.

## Scope Analysis

This epic has **5 child beads** already defined, plus **2 additional deprecated items** discovered during evaluation that are NOT covered by existing beads.

### Covered by Existing Beads

| Bead | Item | Status | Confidence |
|------|------|--------|------------|
| tk2.1 | `NumericUnit` type alias | Ready | HIGH |
| tk2.2 | `getStateSlots()` method | Ready | HIGH |
| tk2.3 | `CompileError` legacy fields | Ready | HIGH |
| tk2.4 | `createRuntimeState()` function | Ready | HIGH |
| 6n6 | `TypeEnv` and typecheck overload | Ready | HIGH |

### NOT Covered - Needs New Beads

| Item | Location | Description | Priority |
|------|----------|-------------|----------|
| `PAYLOAD_STRIDE` constant | src/core/canonical-types.ts:283 | Deprecated lookup table - use `payload.stride` directly | P2 |

## Detailed Analysis

### 1. NumericUnit (tk2.1) - HIGH Confidence
- **Location:** src/core/canonical-types.ts:152
- **Definition:** `export type NumericUnit = Unit['kind'];`
- **Usages:** NONE (grep confirms only definition)
- **Work:** Delete 3 lines (comment + type alias)
- **Risk:** NONE - no usages

### 2. getStateSlots() (tk2.2) - HIGH Confidence
- **Location:** src/compiler/ir/IRBuilderImpl.ts:844
- **Usages:** 1 (pass7-schedule.ts:27)
- **Work:** Update pass7-schedule.ts to use getStateMappings(), remove method
- **Risk:** LOW - single usage point, clear migration path

### 3. CompileError legacy fields (tk2.3) - HIGH Confidence
- **Location:** src/compiler/types.ts:63-68
- **Fields:** `kind`, `location`, `severity`
- **Usages:** `kind` used in diagnosticConversion.ts (3 places)
- **Work:** Update diagnosticConversion.ts to use `code` instead of `kind`
- **Risk:** LOW - contained to one file

### 4. createRuntimeState() (tk2.4) - HIGH Confidence
- **Location:** src/runtime/RuntimeState.ts:590
- **Usages:** Test files only (event-blocks.test.ts, stateful-primitives.test.ts)
- **Work:** Update tests to use createSessionState() + createProgramState()
- **Risk:** LOW - test-only changes

### 5. TypeEnv and typecheck overload (6n6) - HIGH Confidence
- **Location:** src/expr/typecheck.ts:42, 122
- **Usages:** Only internal to typecheck.ts (isTypeEnv guard)
- **Work:** Remove overload, remove TypeEnv type, remove isTypeEnv guard
- **Risk:** LOW - fully contained in one file

### 6. PAYLOAD_STRIDE (NOT COVERED) - HIGH Confidence
- **Location:** src/core/canonical-types.ts:283
- **Usages:** Exported in src/types/index.ts, need to verify actual consumers
- **Work:** Find usages, update to use payload.stride, remove constant
- **Risk:** MEDIUM - may have external consumers to audit

## Dependencies

All items are independent - no ordering constraints between them.

## Recommendations

1. **Create new bead** for PAYLOAD_STRIDE cleanup
2. **Implement all items** - all are HIGH confidence, ready for implementation
3. **Order suggestion:** Start with tk2.1 (simplest), end with 6n6 (most contained complexity)

## Files Impacted

| File | Changes |
|------|---------|
| src/core/canonical-types.ts | Remove NumericUnit, PAYLOAD_STRIDE |
| src/compiler/ir/IRBuilderImpl.ts | Remove getStateSlots() |
| src/compiler/ir/IRBuilder.ts | Remove getStateSlots() from interface |
| src/compiler/types.ts | Remove 3 deprecated fields |
| src/compiler/diagnosticConversion.ts | Update to use `code` instead of `kind` |
| src/compiler/passes-v2/pass7-schedule.ts | Use getStateMappings() |
| src/runtime/RuntimeState.ts | Remove createRuntimeState() |
| src/runtime/index.ts | Remove createRuntimeState export |
| src/expr/typecheck.ts | Remove TypeEnv, overload, isTypeEnv |
| src/blocks/__tests__/event-blocks.test.ts | Update state creation |
| src/blocks/__tests__/stateful-primitives.test.ts | Update state creation |
| src/types/index.ts | Remove PAYLOAD_STRIDE export |

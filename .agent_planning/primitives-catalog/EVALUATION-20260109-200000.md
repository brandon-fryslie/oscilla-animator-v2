# Primitives Catalog Evaluation

**Generated:** 2026-01-09T20:00:00Z
**Topic:** primitives-catalog
**Status:** CONTINUE

---

## Executive Summary

The primitives catalog is approximately **33% complete**. Core infrastructure exists (5-axis type system, block registry pattern, IR lowering), but MVP blocks are missing. No stateful primitives exist. Rail system is unimplemented.

---

## 1. What Exists

### Current Block Implementation: 24 blocks registered

**Time Blocks (2):**
- `InfiniteTimeRoot` - System time source with phase calculation
- `FiniteTimeRoot` - Finite time model variant

**Signal Blocks (5):**
- `ConstFloat` - Constant signal generator
- `AddSignal` - Binary addition of signals
- `MulSignal` - Binary multiplication of signals
- `Oscillator` - Phase-based waveform generator
- `MousePosition` - User input capture

**Domain Blocks (5):**
- `GridDomain` - Create grid domains (rows × cols)
- `DomainN` - Create N-element domain
- `FieldBroadcast` - Broadcast signal to field
- `FieldMap` - Apply operations per-field element
- `FieldZipSig` - Combine fields with signals

**Render/Field Blocks (12):**
- `RenderInstances2D` - Main render sink
- `HueRainbow` - HSV→RGB color conversion
- `FieldAdd`, `FieldAngularOffset`, `FieldAttract2D`, `FieldFromDomainId`
- `FieldGoldenAngle`, `FieldHueFromPhase`, `FieldJitter2D`
- `FieldPolarToCartesian`, `FieldPulse`, `FieldRadiusSqrt`

### Block Registry Structure

- **Location:** `/src/compiler/blocks/registry.ts`
- **Pattern:** Self-registering blocks at module load
- **Type System:** Uses canonical 5-axis SignalType
- **Lowering:** Each block has `lower()` function emitting IR

### Combine System

- `CombineMode` type exists in `/src/types/index.ts`
- Validation utilities in `/src/compiler/passes-v2/combine-utils.ts`
- Modes: last, first, sum, average, max, min, layer, error

---

## 2. What's Missing

### MVP Stateful Primitives (0/4 implemented)

| Block | Definition | Status |
|-------|------------|--------|
| **UnitDelay** | `y(t) = x(t-1)` | NOT IMPLEMENTED |
| **Lag** | Smoothing filter | NOT IMPLEMENTED |
| **Phasor** | Phase accumulator 0..1 | NOT IMPLEMENTED |
| **SampleAndHold** | Latch on trigger | NOT IMPLEMENTED |

### Basic 12 Blocks (4/12 implemented)

| # | Block | Status | Notes |
|---|-------|--------|-------|
| 1 | TimeRoot | ✅ | InfiniteTimeRoot, FiniteTimeRoot |
| 2 | DomainN | ✅ | Implemented |
| 3 | Id/U01 | ❌ | Missing |
| 4 | Hash | ❌ | Missing |
| 5 | Noise | ❌ | Missing |
| 6 | Add | ✅ | AddSignal (signals only) |
| 7 | Mul | ✅ | MulSignal (signals only) |
| 8 | Length | ❌ | Missing |
| 9 | Normalize | ❌ | Missing |
| 10 | UnitDelay | ❌ | Critical - missing |
| 11 | HSV->RGB | ⚠️ | HueRainbow (non-standard) |
| 12 | RenderInstances2D | ✅ | Implemented |

### Rails System (0/5 implemented)

No rail definitions in source code:
- ❌ `time` rail
- ❌ `phaseA` rail
- ❌ `phaseB` rail
- ❌ `pulse` rail
- ❌ `palette` rail

---

## 3. Architecture Gaps

### Critical Gaps

1. **No Formal Primitive Catalog**
   - Blocks scattered across `/src/compiler/blocks/` subdirectories
   - No registry documenting MVP vs extended sets
   - No block metadata (category, description)

2. **Dual Block Registry Problem**
   - `/src/blocks/registry.ts` - Empty stub
   - `/src/compiler/blocks/registry.ts` - Actual working registry
   - **Violates:** ONE SOURCE OF TRUTH

3. **Block "kind" vs "type" Mismatch**
   - Spec: `Block.kind` for discriminator
   - Code: `block.type = 'AddSignal'`
   - Inconsistent with spec language

4. **Missing Block Roles**
   - Current Block type has no role information
   - Spec requires: `role: BlockRole` (user vs derived)

5. **Rail System Not Materialized**
   - Conceptual in spec, not implemented
   - TimeRoot outputs not wired to rails

---

## 4. Dependencies and Risks

### What Could Break

1. **IR Lowering Pipeline** - Block `lower()` tightly coupled to IRBuilder
2. **Type System** - All blocks use SignalType (currently stable)
3. **Block Registry Merge** - Import path changes
4. **Adding Stateful Blocks** - Requires state slot allocation in runtime

### Test Coverage

- ✅ 4 integration/compile tests
- ❌ No unit tests for individual blocks
- ❌ No tests for missing MVP blocks

---

## 5. Ambiguities

1. **Block.kind vs Block.type** - Need to standardize on `kind` per spec
2. **Rails as Blocks** - Spec says "Rails are blocks" but implementation unclear
3. **Block Categories** - Spec lists categories, implementation has none
4. **Default Sources visibility** - Should they be inspectable blocks?

---

## 6. Verdict

**CONTINUE** - Ready to plan implementation.

### Immediate Priorities

1. Implement `UnitDelay` (foundation for all feedback)
2. Add missing basic 12 blocks
3. Consolidate block registries
4. Add block metadata (category, description)

### Scope Recommendation

Focus on MVP block completeness before rail system or composites.

# Definition of Done: Type System P4 - Runtime Migration

**Generated**: 2026-01-09T20:05:00Z
**Plan Reference**: PLAN-20260109-200500.md

---

## Acceptance Criteria

### P0: TypeDesc ↔ SignalType Adapter
- [ ] `typeDescToSignalType()` function exists in `src/core/types.ts`
- [ ] `signalTypeToTypeDesc()` function exists for backward compatibility
- [ ] world='signal' → cardinality=one, temporality=continuous
- [ ] world='field' → cardinality=many(domain), temporality=continuous
- [ ] world='event' → cardinality=one/many, temporality=discrete
- [ ] world='scalar'/'config' → cardinality=zero, temporality=continuous
- [ ] Unit tests for all world→axes mappings in `src/core/__tests__/type-adapter.test.ts`

### P1: SlotMeta Type Metadata
- [ ] `SlotMetaEntry` interface includes `type: SignalType`
- [ ] IR builder populates slotMeta.type from expression types
- [ ] All SigExpr/FieldExpr in CompiledProgramIR have complete type info
- [ ] Slot metadata accessible at runtime via index (O(1) lookup)
- [ ] No string-keyed lookups in evaluation hot path
- [ ] Unit tests in `src/compiler/ir/__tests__/slotMeta.test.ts`

### P2: Runtime Type Assertions
- [ ] `DEBUG_TYPE_CHECK` flag controls assertion mode
- [ ] Payload type assertion during buffer allocation
- [ ] Cardinality consistency assertion at combine points (debug only)
- [ ] Assertions have zero overhead when disabled
- [ ] Error messages include slot ID, expected type, actual type
- [ ] Unit tests in `src/runtime/__tests__/type-assertions.test.ts`

---

## Quality Gates

### Tests
- [ ] All 68+ existing tests pass (`npm run test`)
- [ ] New adapter tests pass (minimum 8 test cases)
- [ ] New slotMeta tests pass (minimum 5 test cases)
- [ ] New assertion tests pass (minimum 5 test cases)

### Build
- [ ] `npm run typecheck` exits 0
- [ ] `npm run build` succeeds
- [ ] No new TypeScript errors

### Regression
- [ ] Steel-thread demo renders correctly (visual inspection)
- [ ] 2000 particles at 60 FPS (performance unchanged)
- [ ] All block categories work: time, domain, signal, render

---

## Definition of Complete

This sprint is **DONE** when:
1. All acceptance criteria boxes checked
2. All quality gates pass
3. Code committed with descriptive message
4. Ready for P5 (constraint solving) to begin

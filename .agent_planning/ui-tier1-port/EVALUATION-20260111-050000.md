# UI Tier 1 Components: Evaluation

**Status**: READY FOR IMPLEMENTATION
**Verdict**: No blockers. All dependencies exist.
**Estimated Effort**: 4-5 hours total

---

## Executive Summary

**InspectorContainer**: Already complete in v2 (95% match with v1)
**BlockLibrary**: Needs adaptation (60% ready) - simplify from v1, integrate with v2 registry
**CSS**: InspectorContainer.css exists, BlockLibrary.css needs porting

All required v2 APIs exist:
- ✅ RootStore with child stores
- ✅ Block registry with categories
- ✅ SelectionStore.setPreviewType()
- ✅ PatchStore.addBlock()

No blocking issues. Ready to implement.

---

## What Exists in V2

### Stores (Complete)
- `SelectionStore`: selectedBlockId, previewType
- `PatchStore`: addBlock(type, params)
- Block registry: 20+ canonical blocks in 7 categories

### Components (Partial)
- `InspectorContainer.tsx`: ✅ Exists and works
- `InspectorContainer.css`: ✅ Exists
- `BlockLibrary.tsx`: ⚠️ Simplified version exists
- `BlockLibrary.css`: ❌ Missing

### Type System (Complete)
- `Block` with `BlockRole` discriminated union
- `BlockTypeInfo` with category, inputs, outputs
- Stable `BlockId` (branded UUID)

---

## What Needs Porting from V1

### InspectorContainer (v1: 82 LOC)
**Status**: ✅ Already ported
**Changes needed**: None (optional: add close button)

### BlockLibrary (v1: 416 LOC)
**Status**: Needs adaptation
**Key changes**:
1. Remove lane filtering (no lanes in v2)
2. Simplify grouping (remove form tiers, use categories only)
3. Update store bindings (useStore → rootStore)
4. Use v2 registry (getBlockTypesByCategory)
5. Defer drag-drop to later phase

### CSS Files
- InspectorContainer.css: ✅ Exists (v2 has 120 lines vs v1's 141 lines)
- BlockLibrary.css: Needs porting (v1 has 354 lines)

---

## Type Mapping (v1 → v2)

| V1 Concept | V2 Canonical | Impact |
|-----------|-------------|--------|
| Block Definition with form | BlockTypeInfo with category | Group by category only |
| Lane affinity | **Removed** | Delete lane filtering |
| Drag-drop (dnd-kit) | Not integrated | Use click-add for Tier 1 |
| store.uiStore.previewDefinition() | selection.setPreviewType(type) | Pass string not object |
| store.patchStore.addBlock(def) | patch.addBlock(type, {}) | Pass type string |

---

## Implementation Approach

### Phase 1: BlockLibrary Adaptation

1. **Remove Lane Logic** (v1 lines 158-192, 303-357)
   - Delete filterByLane, activeLane state
   - Remove lane-based block filtering

2. **Simplify Category Structure**
   - V1: form (tier) → subcategory → blocks
   - V2: category → blocks (flat)
   - Remove form grouping

3. **Update Store Integration**
   ```typescript
   // V1
   const store = useStore();
   store.patchStore.addBlock(definition.type, definition.defaultParams);
   store.uiStore.previewDefinition(definition);

   // V2
   const { patch, selection } = useRootStore();
   patch.addBlock(type, {});
   selection.setPreviewType(type);
   ```

4. **Use Registry**
   ```typescript
   // V1
   const blocks = getBlockDefinitions(includeComposites);

   // V2
   const blocks = getAllBlockTypes();
   const categories = getBlockCategories();
   ```

5. **Defer Drag-Drop**
   - Keep click-preview and double-click-add
   - Remove @dnd-kit/core integration
   - Can add back in Phase 2

### Phase 2: CSS Porting

1. **BlockLibrary.css** (v1: 354 lines)
   - Copy structure from v1
   - Remove tier-subcategory nesting
   - Update colors to match v2 theme
   - Simplify to category-only layout

---

## Dependencies

### Required (All Exist ✅)
- [x] RootStore context
- [x] PatchStore.addBlock(type, params)
- [x] SelectionStore.setPreviewType(type)
- [x] Block registry with categories
- [x] BlockTypeInfo interface

### Optional (Can Defer)
- [ ] @dnd-kit/core (drag-drop)
- [ ] Block colors in registry
- [ ] Composite definitions
- [ ] Subcategories

---

## Risks

### Low Risk
- InspectorContainer: Already complete
- Store integration: APIs exist and compatible
- Type system: v2 simpler but fully compatible

### Medium Risk
- Category filtering: Minor adaptation needed
- Search function: Registry search may differ from v1

### High Risk (Deferred)
- Drag-drop: Requires dnd-kit (Phase 3)
- Block colors: Needs registry metadata
- Composite support: Needs new system

---

## Success Criteria

- [ ] InspectorContainer renders with SelectionStore
- [ ] BlockLibrary shows all blocks by category
- [ ] Search filters blocks by name/description
- [ ] Click-preview updates previewType
- [ ] Double-click creates block
- [ ] No TypeScript errors
- [ ] Styling matches v2 theme
- [ ] Responsive layout

---

## File Locations

### V1 Source
```
~/code/oscilla-animator_codex.worktrees/main-copy/src/editor/
├── components/InspectorContainer.tsx
├── components/InspectorContainer.css
├── BlockLibrary.tsx
└── BlockLibrary.css
```

### V2 Target
```
src/ui/components/
├── InspectorContainer.tsx  # ✅ Exists
├── InspectorContainer.css  # ✅ Exists
├── BlockLibrary.tsx        # ⚠️ Needs adaptation
└── BlockLibrary.css        # ❌ Needs creation
```

---

## Recommendations

1. **Keep InspectorContainer unchanged** (already perfect)
2. **Adapt BlockLibrary** with simplifications
3. **Port BlockLibrary.css** with minor tweaks
4. **No InspectorContainer.css changes** needed
5. **Defer drag-drop** to Phase 2+

**Overall**: Ready for implementation. No blockers.

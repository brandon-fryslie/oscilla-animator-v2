# UI Tier 1 - BlockLibrary and CSS Styling: Definition of Done

## Deliverable 1: BlockLibrary Component Simplification

### Acceptance Criteria

1. **Category-based organization**: BlockLibrary displays blocks grouped by `BlockCategory` enum (Time, Domain, Constants, Field Operations, Rendering, Math, Color). No form tiers. Each category shows block count badge.

2. **Search functionality**: Search input filters blocks by type, label, and description (case-insensitive). Shows result count. Search works across all categories simultaneously. Clears on ESC key or clear button. Debounced to 150ms.

3. **Block preview interaction**: Single-click on block calls `rootStore.selection.setPreviewType(type.type)`. Verified by checking SelectionStore.previewType after click.

4. **Block add interaction**: Double-click on block calls `rootStore.patch.addBlock(type.type, {})` and `rootStore.selection.selectBlock(blockId)`. Verified by checking PatchStore.blocks map size increases.

5. **Category collapse persistence**: Category expand/collapse state persists to localStorage. After page reload, previously collapsed categories remain collapsed. Verified with localStorage mock in test.

6. **Port metadata display**: Each block item shows: label (bold), type (monospace), description (gray), port counts (e.g., "2 in, 1 out"). Description truncates with ellipsis if longer than 3 lines.

7. **Keyboard navigation**: Arrow up/down navigates between blocks within category. Enter key previews block. Shift+Enter adds block. Tab/Shift+Tab moves between categories. Verified with keyboard event simulation.

8. **No lane logic**: Zero references to `activeLane`, `filterByLane`, `laneKind`, or `laneAffinity` in BlockLibrary.tsx. Grep for "lane" returns no matches in the file.

---

## Deliverable 2: CSS Styling Port and Theme Alignment

### Acceptance Criteria

1. **Color palette alignment**: BlockLibrary.css uses v2 color palette exclusively. All colors match theme.ts: bgContent (#0f0f23), bgPanel (#16213e), border (#0f3460), primary (#4ecdc4), text colors (#eee, #888, #666).

2. **Visual consistency**: BlockLibrary header, scrollbar, and border styles visually match InspectorContainer.css. Verified with side-by-side screenshot comparison.

3. **Responsive hover states**: `.block-item:hover` background changes to `rgba(255, 255, 255, 0.05)`. Transition duration 150ms. Selected state has border color `colors.primary` and distinct background (#2a3a4a).

4. **Typography consistency**: Font family matches theme.ts. Font sizes: header 0.875rem, block label 0.8125rem, metadata 0.7rem, port counts 0.65rem.

5. **No drag-drop styles**: Zero references to `.block-drag-handle`, `.drag-grip`, `.dragging`, `cursor: grab` in BlockLibrary.css.

6. **Scrollbar styling**: `.library-categories` scrollbar matches InspectorContainer: 8px width, rounded thumb, hover changes to `colors.primary`. Works on WebKit browsers.

---

## General Acceptance Criteria

- ✅ All public functions have TSDoc comments
- ✅ Zero TypeScript errors in strict mode
- ✅ No `any` types
- ✅ ESLint passes with no warnings
- ✅ Test coverage >80% for BlockLibrary
- ✅ Integration tests: preview/add verify store updates
- ✅ Performance test: search <50ms for 50 blocks
- ✅ All existing tests pass (no regressions)

---

## Definition of DONE

Sprint is DONE when:
1. All 14 acceptance criteria above are met
2. All tests pass (unit, integration, visual)
3. TypeScript strict mode with zero errors
4. Code review approved
5. Demo shows: search, preview click, add double-click, collapse persistence
6. No console warnings
7. Search response <50ms for 50-block registry

Agent: iterative-implementer | 2026-01-20 16:00:00
Mode: manual
Completed: Unified shape foundation (Option A) | Files: 8 | Commits: 2
Tests: All passing (362 passed, 34 skipped)
Cache invalidated: runtime-unified-inputs.md marked STALE
Status: complete

Implementation Summary:
- Created src/shapes/{types.ts, topologies.ts, registry.ts} defining topology system
- Updated primitive-blocks.ts: Ellipse/Rect use sigShapeRef with param signals (rx, ry, rotation, cornerRadius)
- Updated compiler/ir/types.ts: Added SigExprShapeRef, updated StepRender with topologyId + paramSignals
- Updated compiler/passes-v2/pass7-schedule.ts: Added resolveShapeInfo() for shape resolution
- Updated runtime/ScheduleExecutor.ts: Added ShapeDescriptor type, evaluates param signals
- Updated render/Canvas2DRenderer.ts: Uses getTopology().render() instead of hardcoded switches
- Updated compiler/ir/IRBuilder.ts: Added getSigExprs() and getFieldExprs() methods

Architecture:
- TopologyId is compile-time constant (known after block lowering)
- Param values are runtime signals (evaluated each frame)
- StepRender.shape = { k: 'sig'; topologyId; paramSignals } follows existing pattern
- No hardcoded shape switches in renderer - dispatches to topology.render()

Validation:
- npm run typecheck: PASS (no errors)
- npm test: PASS (362 tests passed)
- Ellipse with rx≠ry will render as actual ellipse (not circle)
- Rect with width≠height will render as actual rectangle (not square)

Next Steps:
- User can test by creating Ellipse/Rect blocks with different rx/ry or width/height values
- Shape rotation and cornerRadius now available as inputs
- Ready for Field<shape> support when needed (uses same topology system)

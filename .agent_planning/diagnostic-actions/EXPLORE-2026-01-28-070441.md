# Exploration Output: Diagnostic Actions
Timestamp: 2026-01-28-070441
Agent: explore (haiku)

## Diagnostic Actions Implementation Analysis - Oscilla Animator v2

### 1. **Current State of DiagnosticAction Type** ‚úÖ
**File**: `/Users/bmf/code/oscilla-animator-v2/src/diagnostics/types.ts` (lines 171-186)

```typescript
export interface DiagnosticAction {
  readonly id: string;           // Unique action ID
  readonly label: string;        // User-facing label
  readonly kind: 'automated' | 'guided';  // One-click vs multi-step
  readonly payload?: unknown;    // Action-specific data
}
```

**Status**: INCOMPLETE for Sprint 1. The interface is generic and deferred to Sprint 2+. It does **NOT** implement the 7 specific action kinds from the spec.

---

### 2. **7 Action Kinds from Spec vs Implementation** ‚ùå
**Spec Definition** (design-docs/CANONICAL-oscilla-v2.5-20260109/topics/07-diagnostics-system.md, lines 368-379):

```typescript
type DiagnosticAction =
  | { kind: 'goToTarget'; target: TargetRef }
  | { kind: 'insertBlock'; blockType: string; position?: 'before' | 'after'; nearBlockId?: string }
  | { kind: 'removeBlock'; blockId: string }
  | { kind: 'addAdapter'; fromPort: PortTargetRef; adapterType: string }
  | { kind: 'createTimeRoot'; timeRootKind: 'Infinite' }
  | { kind: 'muteDiagnostic'; diagnosticId: string }
  | { kind: 'openDocs'; docUrl: string };
```

**Current Implementation**: Spec-defined action kinds are **NOT implemented** in types.ts. Only generic interface exists.

---

### 3. **Where Diagnostics Are Created** üìç
**Files producing diagnostics**:

| File | Line | Type | Produces |
|------|------|------|----------|
| **src/diagnostics/validators/authoringValidators.ts** | 37-52 | Authoring | `E_TIME_ROOT_MISSING`, `E_TIME_ROOT_MULTIPLE`, `W_GRAPH_DISCONNECTED_BLOCK`, `W_GRAPH_UNUSED_OUTPUT`, `E_CONST_VALUE_INVALID` |
| **src/compiler/diagnosticConversion.ts** | 152-209 | Compiler | Converts `CompileError` ‚Üí `Diagnostic` (type mismatch, cycles, etc.) |
| **src/compiler/compile.ts** | (implicitly) | Compiler | Emits `CompileEnd` with diagnostics array |
| **src/runtime/HealthMonitor.ts** | (potential) | Runtime | Would emit `RuntimeHealthSnapshot` with runtime diagnostics (Sprint 2) |

---

### 4. **Actions Attached to Diagnostics** üîç
**Finding**: **NO actions currently attached to any diagnostic**.

- Line 241 in types.ts shows `readonly actions?: readonly DiagnosticAction[];` is optional and unused
- No diagnostic creation code adds actions
- authoringValidators.ts creates diagnostics without actions (line 87-102, 115-130, etc.)
- diagnosticConversion.ts creates diagnostics without actions (line 173-189)
- Test code (DiagnosticHub.test.ts) does not attach actions

---

### 5. **Action Handler/Executor Code** ‚ùå
**Finding**: **No action handler or executor code exists**.

- No files found matching: `QuickFix`, `ActionExecutor`, `executeAction`, `applyAction`, `handleAction`
- DiagnosticConsole.tsx (lines 1-100) displays diagnostics but has NO action buttons
- DiagnosticsStore.ts has NO methods for executing actions
- Spec requirement (line 835-854) for "Action Determinism Contract" is not implemented

---

### 6. **Test Coverage for DiagnosticAction** üß™
**Test Files Found**:
- `src/diagnostics/__tests__/DiagnosticHub.test.ts` - Tests snapshot semantics, no action tests
- `src/diagnostics/__tests__/diagnosticId.test.ts` - Tests ID generation, no action tests
- `src/diagnostics/__tests__/cardinality-diagnostics.test.ts` - No action tests
- `src/diagnostics/__tests__/payload-diagnostics.test.ts` - No action tests
- `src/diagnostics/validators/__tests__/authoringValidators.test.ts` - Validates TimeRoot, no action tests

**Result**: **ZERO test coverage** for DiagnosticAction execution or handlers.

---

### 7. **TODO/FIXME Comments** üìù
**Found in src/diagnostics/config.ts** (lines 2-11):

```typescript
/**
 * TODO: Migrate to app-wide settings panel when available.
 * Migration path:
 * 1. Move DiagnosticsConfig interface into app settings
 * 2. Replace DIAGNOSTICS_CONFIG imports with appSettings.diagnostics
 * 3. No other code changes needed
 */
```

**No TODO/FIXME for diagnostic actions specifically.**

---

### 8. **Recent Changes to Diagnostics System** üîÑ
**Files Indicate Recent Work**:
- src/diagnostics/types.ts - Well-documented, Sprint 1 baseline
- src/diagnostics/DiagnosticHub.ts - Complete event handling for five-event spine
- src/diagnostics/validators/authoringValidators.ts - TimeRoot + connectivity validation
- src/compiler/diagnosticConversion.ts - Error ‚Üí Diagnostic conversion pipeline
- src/ui/components/app/DiagnosticConsole.tsx - UI rendering with frame timing stats

**Roadmap** (README.md lines 477-499):
- Sprint 1 ‚úÖ: Core types, EventHub, DiagnosticHub, authoring validators
- **Sprint 2 üöß**: Runtime diagnostics, **actions** (deferred), bus warnings
- **Sprint 3 üîÆ**: Grouping, export diagnostics, advanced UI

---

### 9. **Dependencies for Action Handlers** üîó
**Required UI/State Components**:

| Component | Location | Purpose | Status |
|-----------|----------|---------|--------|
| **PatchStore** | src/stores/PatchStore.ts | Mutations (insertBlock, removeBlock, etc.) | ‚úÖ Exists |
| **SelectionStore** | src/stores/SelectionStore.ts | Track selected block for navigation | ‚úÖ Exists |
| **EventHub** | src/events/EventHub.ts | Emit graph mutations | ‚úÖ Exists |
| **DiagnosticsStore** | src/stores/DiagnosticsStore.ts | MobX wrapper for UI | ‚úÖ Exists (lines 1-100+) |
| **Action Button UI** | src/ui/components/app/ | Render action buttons | ‚ùå Missing |
| **Action Handler** | (needed) | Execute action payload | ‚ùå Missing |
| **Undo/Redo Integration** | src/stores/ | Make actions undoable | ‚ùå Missing |

---

### **Summary Table: Implementation Readiness**

| Requirement | Status | Details |
|------------|--------|---------|
| Type Definition | üü° Partial | Generic interface exists; spec types missing |
| 7 Action Kinds | ‚ùå Not Implemented | `goToTarget`, `insertBlock`, etc. not in types |
| Action Creation | ‚ùå None | No diagnostic currently has actions |
| Action Execution | ‚ùå Missing | No handler, executor, or UI buttons |
| Test Coverage | ‚ùå None | Zero tests for action functionality |
| Roadmap Status | ‚ÑπÔ∏è Deferred | Sprint 2 feature, currently in Sprint 1 |
| Dependencies | üü¢ Ready | PatchStore, EventHub, UI frameworks available |

---

### **Key Findings**

1. **DiagnosticAction is placeholder code** - Current interface (lines 181-186 types.ts) is generic stubs with `id`, `label`, `kind: 'automated'|'guided'`, and optional `payload`. This does NOT match spec's discriminated union with 7 specific action kinds.

2. **Zero implementation of the 7 spec-defined actions**:
   - `goToTarget` - Navigate to diagnostic target (would use SelectionStore)
   - `insertBlock` - Would use PatchStore.addBlock()
   - `removeBlock` - Would use PatchStore.removeBlock()
   - `addAdapter` - Would insert adapter block between ports
   - `createTimeRoot` - Would use PatchStore.addBlock('InfiniteTimeRoot')
   - `muteDiagnostic` - Would need mute state in DiagnosticHub
   - `openDocs` - Would open URL

3. **No action handler architecture** - Missing:
   - Discriminated union type definitions for each action kind
   - Action execution dispatch function
   - UI components to render action buttons
   - Undo/redo support for executed actions

4. **Sprint roadmap deferred to Sprint 2** - README.md and spec acknowledge actions are planned but not included in Sprint 1 baseline.

# Definition of Done: Compilation Pipeline Sprint

**Sprint:** 2026-01-09
**Topic:** Compilation Pipeline - Next Phase
**Status:** Pending user decision on focus area

---

## Current State (Baseline)

- `npm run typecheck` passes with 0 errors
- `npm run test` passes all 68 tests
- Application builds and runs correctly
- Linear pipeline functional

---

## Option-Specific DoD

### If Option A (Graph Normalization):

**AC-A1: Default Source Materialization**
- [ ] Unconnected inputs with default sources generate synthetic blocks
- [ ] Synthetic blocks appear in normalized graph
- [ ] Debug provenance tracks synthetic blocks as "defaultSource"

**AC-A2: Type Assignment**
- [ ] All blocks have canonical types after normalization
- [ ] Type errors report source location

**AC-A3: Tests**
- [ ] New tests for default source cases
- [ ] Existing tests pass

---

### If Option B (ScheduleIR Definition):

**AC-B1: ScheduleIR Type Defined**
- [ ] `ScheduleIR` interface defined in `program.ts`
- [ ] Replaces `type ScheduleIR = unknown`
- [ ] Includes: timeModel, steps, domains

**AC-B2: Builder Updated**
- [ ] `builder.ts` returns typed ScheduleIR
- [ ] No `as any` cast on schedule
- [ ] `build()` return type is fully typed

**AC-B3: Runtime Typed**
- [ ] `ScheduleExecutor.ts` uses typed ScheduleIR
- [ ] No runtime casts for schedule access

**AC-B4: Tests**
- [ ] Typecheck passes with 0 errors
- [ ] All 68 tests pass

---

### If Option C (Multi-Pass Architecture):

**AC-C1: Decision Made**
- [ ] passes-v2 evaluated: complete or delete
- [ ] Architecture decision documented

**AC-C2: Staged Pipeline**
- [ ] Each pass is isolated function
- [ ] Explicit I/O types between passes
- [ ] No back-edges (later stages don't mutate earlier)

**AC-C3: Testing**
- [ ] Pass-level unit tests added
- [ ] Integration tests pass

---

### If Option D (Domain Unification):

**AC-D1: Domain Compatibility**
- [ ] Domain compatibility rules defined
- [ ] Fields validated for domain match

**AC-D2: Errors**
- [ ] Domain mismatch produces compile error
- [ ] Error includes domain context

**AC-D3: Tests**
- [ ] Domain error test cases
- [ ] Existing tests pass

---

## Universal Criteria (All Options)

- [ ] `npm run typecheck` passes
- [ ] `npm run test` passes all tests
- [ ] `npm run dev` renders correctly
- [ ] No new `any` types introduced
- [ ] Documentation updated if API changes

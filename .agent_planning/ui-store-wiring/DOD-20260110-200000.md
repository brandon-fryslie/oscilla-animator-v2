# Definition of Done: UI Store Wiring - React Conversion

**Topic**: ui-store-wiring
**Created**: 2026-01-10
**Plan**: PLAN-20260110-200000.md

## Acceptance Criteria

### Phase 0: Selection State Migration
- [ ] rootStore.selection is the single source of truth for selection
- [ ] getSelectionState() removed or is thin adapter to rootStore.selection
- [ ] No duplicate selection state management
- [ ] All existing selection functionality preserved

### Phase 1: Simple Conversions

#### DomainsPanel
- [ ] DomainsPanel.tsx exists as React functional component
- [ ] Uses observer() from mobx-react-lite
- [ ] Observes rootStore.patch for domain data
- [ ] Domains displayed as expandable cards
- [ ] Local state for expanded domains (useState)
- [ ] Old DomainsPanel.ts deleted

#### BlockLibrary
- [ ] BlockLibrary.tsx exists as React functional component
- [ ] Shows block types organized by category
- [ ] Search input filters block list
- [ ] Category sections are expandable
- [ ] Click block type → sets previewType in selection state (preview mode)
- [ ] Double-click OR "Add" button → calls rootStore.patch.addBlock(type)
- [ ] After adding, new block is selected
- [ ] Old BlockLibrary.ts deleted

### Phase 2: Selection-Dependent Components

#### BlockInspector
- [ ] BlockInspector.tsx exists as React functional component
- [ ] Uses observer() for reactivity
- [ ] Observes rootStore.selection.selectedBlockId AND previewType
- [ ] When previewType set: shows block type preview with "[TYPE PREVIEW]" header
- [ ] When block selected: shows block details (type, id, ports)
- [ ] When neither: shows "No block selected" message
- [ ] Port connections are clickable → navigates to connected block
- [ ] Type preview shows: name, category, description, inputs/outputs with types
- [ ] Uses InspectorContainer for layout
- [ ] Old BlockInspector.ts deleted

#### TableView
- [ ] TableView.tsx exists as React functional component
- [ ] Uses observer() for reactivity
- [ ] Shows blocks in table with expand/collapse rows
- [ ] Click row header → rootStore.selection.selectBlock(id)
- [ ] Selected row is visually highlighted
- [ ] Block details visible when expanded
- [ ] Old TableView.ts deleted

### Phase 3: Integration

#### main.ts Wiring
- [ ] All converted components mounted via React.createRoot
- [ ] Components receive necessary props (patch observable if needed)
- [ ] No vanilla component instantiation for converted components
- [ ] ConnectionMatrix used directly (no wrapper)
- [ ] App loads and runs without console errors

#### Cleanup
- [ ] ConnectionMatrixWrapper.ts deleted
- [ ] src/ui/state/selection.ts deleted (or thin adapter)
- [ ] src/ui/components/index.ts exports updated
- [ ] No orphaned imports or dead code

## Verification

### Automated
- [ ] `npm run typecheck` passes with no errors
- [ ] `npm run test` - all tests pass
- [ ] `npm run build` completes successfully

### Manual Runtime Verification
- [ ] Start dev server, app loads
- [ ] Block library shows all block types
- [ ] Click a block type → new block appears in patch
- [ ] Table view shows the new block
- [ ] Click the block row → row highlights
- [ ] Inspector shows the selected block's details
- [ ] Click a connection in inspector → selection changes to connected block
- [ ] Domains panel shows domains from patch

## Out of Scope (Verified NOT implemented)
- Keyboard shortcuts (Delete key to remove blocks)
- Context menus for blocks
- Edge creation UI
- Parameter editing in inspector
- Auto-recompile on patch changes
- Block type preview on hover (P8 feature)

# Evaluation: Unified Param/Input Architecture

**Generated:** 2026-01-20
**Topic:** Unify params and inputs - params as source of truth

## Problem Statement (Revised)

The current architecture has two overlapping concepts:
- **`inputs`**: Port definitions with types, uiHints, defaultValues, defaultSources
- **`params`**: Config values that often duplicate input info

This causes:
1. Duplication - same info in two places (e.g., `radius` in both inputs and params)
2. Sync risk - inputs and params can drift apart
3. Confusion - when to use which?

## Proposed Architecture

**Params become the single source of truth.** Each param can optionally expose itself as a wirable input port.

```typescript
interface ParamDef {
  value: unknown;                    // Default value
  type?: SignalType;                 // For type checking (optional for non-wirable)
  uiHint?: UIControlHint;            // UI rendering hint
  label?: string;                    // Display label (defaults to param key)

  // NEW: Port exposure
  exposedAs?: 'input' | 'output' | 'none';  // Default: 'none'
  optional?: boolean;                // For inputs: is wiring optional?
  defaultSource?: DefaultSource;     // For inputs: what to wire if unwired
}
```

## Examples

### Before (Current)
```typescript
registerBlock({
  type: 'Circle',
  inputs: [
    {
      id: 'radius',
      label: 'Radius',
      type: signalType('float'),
      defaultValue: 0.02,
      defaultSource: defaultSourceConst(0.02),
      uiHint: { kind: 'slider', min: 0.01, max: 0.5, step: 0.01 },
    },
  ],
  params: {
    radius: 0.02,  // Duplicated!
  },
});
```

### After (Unified)
```typescript
registerBlock({
  type: 'Circle',
  params: {
    radius: {
      value: 0.02,
      type: signalType('float'),
      label: 'Radius',
      uiHint: { kind: 'slider', min: 0.01, max: 0.5, step: 0.01 },
      exposedAs: 'input',
      defaultSource: defaultSourceConst(0.02),
    },
  },
});
```

### Const Block
```typescript
registerBlock({
  type: 'Const',
  params: {
    value: {
      value: 0,
      uiHint: { kind: 'slider', min: 1, max: 10000, step: 1 },
      // NOT exposed as input - Const has no inputs
    },
    payloadType: {
      value: undefined,
      hidden: true,  // Set by normalizer, not shown in UI
    },
  },
  outputs: [
    { id: 'out', label: 'Output', type: signalType('???') },
  ],
});
```

### Math Block (Input-only, no config fallback)
```typescript
registerBlock({
  type: 'Add',
  params: {
    a: {
      value: 0,
      type: signalType('float'),
      exposedAs: 'input',
      optional: false,  // Must be wired
    },
    b: {
      value: 0,
      type: signalType('float'),
      exposedAs: 'input',
      optional: false,
    },
  },
});
```

## What Changes

### Type Changes
1. `BlockDef.params` changes from `Record<string, unknown>` to `Record<string, ParamDef | unknown>`
2. `BlockDef.inputs` becomes **derived** (or deprecated, generated from params)
3. New `ParamDef` interface

### Code Changes
1. **registry.ts**: New types, possibly generate `inputs` array from params
2. **All block files**: Migrate to new param structure
3. **BlockInspector.tsx**: Read from params instead of inputs for UI hints
4. **Normalizer/Compiler**: May need updates to read port info from params

### Migration Strategy
- Support both old and new format during transition
- `inputs` array can be auto-generated from params with `exposedAs: 'input'`
- Or keep explicit `inputs`/`outputs` for ports, params for config only

## Open Questions

1. **Outputs too?** Should outputs also be param-derived? Probably not - outputs are fundamentally different (they're computed, not configured).

2. **Backward compatibility?** Should we support both formats? Or clean migration?

3. **What about inputs-only blocks?** (Add, Multiply) - do they need params at all, or just inputs?

## Recommendation

**Hybrid approach:**
- Keep `outputs` as-is (they're different - computed not configured)
- Unify `inputs` and `params` via new ParamDef structure
- Generate `inputs` array from params for backward compat with existing code
- Migrate blocks incrementally

## Verdict

**PAUSE** - Need user input on:
1. Do we keep outputs separate? (Recommended: yes)
2. Backward compat strategy?
3. Scope - all blocks or just ones that need uiHint?
